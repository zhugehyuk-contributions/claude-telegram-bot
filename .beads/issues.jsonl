{"id":"agi-02p","title":"Unbounded queue growth in cron scheduler","description":"Security: pendingCronJobs queue grows without bound\n\nLocation: src/scheduler.ts:26, 104-106\n\nIssue: No max queue size limit. Jobs queue faster than execution\nImpact: Memory exhaustion if bot busy for extended period\n\nFix: Add max queue size (e.g., 100), reject or discard oldest when full","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:56:44.643292886+09:00","created_by":"Z","updated_at":"2026-02-02T02:10:26.363263772+09:00","closed_at":"2026-02-02T02:10:26.363263772+09:00","close_reason":"Closed"}
{"id":"agi-077","title":"Rename bd prefix to 9yr","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T00:21:19.656433209+09:00","created_by":"Z","updated_at":"2026-02-02T01:03:29.873565616+09:00","closed_at":"2026-02-02T01:03:29.873565616+09:00","close_reason":"Closed"}
{"id":"agi-14p","title":"make up fails when service not installed - need fallback for dev mode","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T00:31:00.298338736+09:00","created_by":"Z","updated_at":"2026-02-02T01:03:23.063988473+09:00","closed_at":"2026-02-02T00:35:05.846589507+09:00","close_reason":"Closed"}
{"id":"agi-30z","title":"Fix: handleRetry missing ctx.message undefined check","description":"Missing undefined check in handleRetry command\n\nLocation: src/handlers/commands.ts:467-506\n\nIssue: Creates fake context by spreading ctx.message which could be undefined in edge cases\n\nImpact: Potential crash when ctx.message is undefined\n\nFix: Add guard check before spreading ctx.message","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:48:14.256348813+09:00","created_by":"Z","updated_at":"2026-02-02T01:52:35.234822399+09:00","closed_at":"2026-02-02T01:52:35.234822399+09:00","close_reason":"Closed"}
{"id":"agi-5eb","title":"fix: spinner recreates itself on timer (infinite delete/create)","description":"Bug: Timer interval recreates spinner every second instead of editing\n\nCurrent broken logic:\n- Timer calls recreateProgressMessage() every 1s\n- recreateProgressMessage = DELETE + CREATE new message\n- Result: Spinner constantly deleted/recreated (flashing)\n\nCorrect logic should be:\n- Timer: EDIT existing message (update text only)\n- New output added: DELETE + CREATE (move to bottom)\n\nFix:\n1. Timer should use editMessageText (not delete/create)\n2. Only recreate when new messages are added\n3. Recreate = delete old + create new at bottom","status":"closed","priority":1,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:26:56.019383359+09:00","created_by":"Z","updated_at":"2026-02-02T01:28:35.979823832+09:00","closed_at":"2026-02-02T01:28:35.979823832+09:00","close_reason":"Closed"}
{"id":"agi-5kf","title":"Fix: recreateProgressMessage uncaught promise in initialization","description":"Uncaught promise during progress message initialization\n\nLocation: src/handlers/streaming.ts:154-155\n\nIssue: recreateProgressMessage() called without await, fire-and-forget. Errors may not propagate.\n\nImpact: Silent failures during initialization\n\nFix: Add await or explicit error handling, or document intentional fire-and-forget","status":"closed","priority":3,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:48:29.59035452+09:00","created_by":"Z","updated_at":"2026-02-02T01:52:35.236472574+09:00","closed_at":"2026-02-02T01:52:35.236472574+09:00","close_reason":"Closed"}
{"id":"agi-6u4","title":"Critical: Progress timer needs per-conversation tracking","description":"Oracle found: Global progressInterval will clobber across multiple conversations\n\nIssue: StreamingState is per-message but progressInterval is global\nImpact: Multiple concurrent conversations will overwrite each other's timers\nRisk: Orphaned intervals, memory leaks, wrong chat getting updates\n\nFix: Use Map\u003cchatId, {interval, startTime}\u003e with 5-minute max timeout","status":"closed","priority":1,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:54:33.142349425+09:00","created_by":"Z","updated_at":"2026-02-02T02:10:40.327604327+09:00","closed_at":"2026-02-02T02:10:40.327604327+09:00","close_reason":"Closed"}
{"id":"agi-8uk","title":"Timer resource leak on error paths in streaming","description":"Security: progressTimer never cleared if error occurs before 'done'\n\nLocation: src/handlers/streaming.ts:159-183\n\nIssue: Timer started but only cleared when statusType==='done'. If error occurs before done, timer leaks\nImpact: Resource exhaustion over time with repeated failures\n\nFix: Add cleanup in error handlers, finally blocks, or max timeout","status":"closed","priority":1,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:56:26.057388317+09:00","created_by":"Z","updated_at":"2026-02-02T02:10:26.361441198+09:00","closed_at":"2026-02-02T02:10:26.361441198+09:00","close_reason":"Closed"}
{"id":"agi-a1s","title":"Integrate multi-provider usage into /stats command","description":"Update handleStats in src/handlers/commands.ts to display Claude, Codex, and Gemini usage.\n\n## Display Format\n\n```\nğŸ“Š Session Statistics\n\n... (existing session stats) ...\n\nğŸŒ Provider Usage\n\nClaude Code:\n   5h: 45% (resets in 2h 15m)\n   7d: 12% (resets in 5d 3h)\n\nOpenAI Codex (plus):\n   5h: 30% (resets in 1h 45m)\n   7d: 8% (resets in 6d 12h)\n\nGemini (gemini-2.0-flash):\n   Usage: 25% (resets in 4h)\n```\n\n## Implementation\n1. Call fetchAllUsage() at start of handler\n2. Format each provider's usage with percentage and reset time\n3. Skip providers that return null (not installed/authenticated)\n4. Show loading indicator or cache status","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:31:48.508641909+09:00","created_by":"Z","updated_at":"2026-02-02T01:35:16.194224801+09:00","closed_at":"2026-02-02T01:35:16.194224801+09:00","close_reason":"Closed","dependencies":[{"issue_id":"agi-a1s","depends_on_id":"agi-e5r","type":"blocks","created_at":"2026-02-02T01:31:59.801718889+09:00","created_by":"Z"}]}
{"id":"agi-cnf","title":"Port to Rust","description":"Plan and execute a full port of the TypeScript Telegram bot to Rust, including architecture, feature parity, and deployment.","status":"in_progress","priority":2,"issue_type":"epic","owner":"z@2lab.ai","created_at":"2026-02-02T01:52:10.21969328+09:00","created_by":"Z","updated_at":"2026-02-02T01:53:34.179762594+09:00"}
{"id":"agi-cnf.10","title":"Rust port: formatting module","description":"Scope:\n- Markdown -\u003e Telegram HTML conversion.\n- Tool status formatting (emoji + truncation).\nDeliverables:\n- formatting.rs with tests covering edge cases.","notes":"Review: escape HTML correctly; keep code blocks intact; verify Telegram HTML constraints.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:01:37.131597449+09:00","created_by":"Z","updated_at":"2026-02-02T02:06:01.520974554+09:00","dependencies":[{"issue_id":"agi-cnf.10","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:01:37.132603841+09:00","created_by":"Z"}]}
{"id":"agi-cnf.11","title":"Rust port: streaming state module","description":"Scope:\n- Message segmentation + edit throttling.\n- Progress spinner timer + completion message.\n- Delete thinking/tool messages based on config; add reaction on completion.\nDeliverables:\n- streaming.rs state + status callback implementation.","notes":"Review: avoid timer race on progress message; throttle edits; split oversized messages safely; honor delete flags.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:01:48.527392763+09:00","created_by":"Z","updated_at":"2026-02-02T02:06:12.869832053+09:00","dependencies":[{"issue_id":"agi-cnf.11","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:01:48.528201928+09:00","created_by":"Z"}]}
{"id":"agi-cnf.12","title":"Rust port: bot core + routing","description":"Scope:\n- Teloxide bot init + dispatcher + error handler.\n- Per-chat sequentialization for non-command messages.\n- Command registration and startup/resume/restart notifications.\nDeliverables:\n- main.rs / handlers::mod wired.","notes":"Review: sequentialize only non-command/non-! messages; callbacks bypass queue; startup resume + restart message update.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:02:07.893717767+09:00","created_by":"Z","updated_at":"2026-02-02T02:06:22.990499708+09:00","dependencies":[{"issue_id":"agi-cnf.12","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:02:07.894575231+09:00","created_by":"Z"}]}
{"id":"agi-cnf.13","title":"Rust port: text handler","description":"Scope:\n- Authorization + rate limit + ! interrupt flow.\n- Start typing indicator, stream response, retry on crash.\n- Audit logging integration.\nDeliverables:\n- handlers/text.rs parity with TS flow.","notes":"Review: rate limit before heavy work; retry only on claude crash; audit log original user text; interrupt flow clears stopRequested.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:02:19.13550156+09:00","created_by":"Z","updated_at":"2026-02-02T02:06:33.124579359+09:00","dependencies":[{"issue_id":"agi-cnf.13","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:02:19.136254843+09:00","created_by":"Z"}]}
{"id":"agi-cnf.14","title":"Rust port: voice handler","description":"Scope:\n- Download voice file, call OpenAI transcription.\n- Show transcript + send to session.\n- Cleanup temp files + error handling.\nDeliverables:\n- handlers/voice.rs parity with TS.","notes":"Review: check transcription availability; handle download errors; ensure temp file cleanup on all exits.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:02:29.267172527+09:00","created_by":"Z","updated_at":"2026-02-02T02:06:43.282861852+09:00","dependencies":[{"issue_id":"agi-cnf.14","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:02:29.268059452+09:00","created_by":"Z"}]}
{"id":"agi-cnf.15","title":"Rust port: photo handler + media group buffer","description":"Scope:\n- Download photos and buffer media groups (1s).\n- Build prompts for single vs album.\n- Status messages + cleanup.\nDeliverables:\n- handlers/photo.rs + media_group.rs.","notes":"Review: album buffering uses 1s timeout; caption handling; delete status messages; remove temp photos.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:02:39.425967205+09:00","created_by":"Z","updated_at":"2026-02-02T02:06:54.645704144+09:00","dependencies":[{"issue_id":"agi-cnf.15","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:02:39.427521764+09:00","created_by":"Z"}]}
{"id":"agi-cnf.16","title":"Rust port: document handler","description":"Scope:\n- Download docs; detect PDF/text/archive.\n- PDF extraction via pdftotext; text size limits.\n- Archive extraction + file tree + prompt assembly.\nDeliverables:\n- handlers/document.rs parity with TS.","notes":"Review: enforce 10MB limit; secure archive extraction (no path traversal); cap total extracted content.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:02:50.716534486+09:00","created_by":"Z","updated_at":"2026-02-02T02:07:04.767633727+09:00","dependencies":[{"issue_id":"agi-cnf.16","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:02:50.71742603+09:00","created_by":"Z"}]}
{"id":"agi-cnf.17","title":"Rust port: callback handler + ask_user integration","description":"Scope:\n- Parse inline button callbacks (askuser:\u003cid\u003e:\u003cidx\u003e).\n- Read /tmp/ask-user-*.json; send inline keyboards.\n- Inject selection back into session.\nDeliverables:\n- handlers/callback.rs parity.","notes":"Review: validate callback data; handle missing/expired request file; always answer callback query; interrupt semantics before sending choice.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:03:09.120630796+09:00","created_by":"Z","updated_at":"2026-02-02T02:07:14.905825442+09:00","dependencies":[{"issue_id":"agi-cnf.17","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:03:09.121448806+09:00","created_by":"Z"}]}
{"id":"agi-cnf.18","title":"Rust port: cron scheduler","description":"Scope:\n- Parse cron.yaml (yaml).\n- Schedule jobs; queue if session busy; rate limit.\n- Notify user with results.\nDeliverables:\n- scheduler.rs parity with TS.","notes":"Review: cron.yaml path validation; rate limit jobs/hour; queue when session busy; file watcher reload safety.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:03:19.252307001+09:00","created_by":"Z","updated_at":"2026-02-02T02:07:26.254130958+09:00","dependencies":[{"issue_id":"agi-cnf.18","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:03:19.253230995+09:00","created_by":"Z"}]}
{"id":"agi-cnf.19","title":"Rust port: usage stats module","description":"Scope:\n- Fetch Claude/Codex/Gemini usage with caching.\n- Implement /stats formatting.\nDeliverables:\n- usage.rs parity with TS.","notes":"Review: timeouts for provider API calls; cache TTL behavior; mac keychain fallback to file; handle missing creds gracefully.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:03:30.598056541+09:00","created_by":"Z","updated_at":"2026-02-02T02:07:36.384547929+09:00","dependencies":[{"issue_id":"agi-cnf.19","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:03:30.598917606+09:00","created_by":"Z"}]}
{"id":"agi-cnf.2","title":"Rust port: architecture + crate selection + module map","description":"Scope:\n- Map TS modules to Rust modules (config/security/session/handlers/scheduler/usage/etc).\n- Choose core crates and runtime (teloxide, tokio, reqwest, serde, tracing, etc).\n- Identify parity gaps and risks (Claude CLI vs SDK, MCP config, thinking tokens).\nDeliverables:\n- Module map + data flow notes.\n- Crate list with rationale.\n- Risk list with mitigation ideas.","notes":"Review: include ask_user MCP + usage stats in module map; capture CLI vs SDK decision + rollback/migration steps.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:00:03.629676818+09:00","created_by":"Z","updated_at":"2026-02-02T02:04:37.9705357+09:00","dependencies":[{"issue_id":"agi-cnf.2","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:00:03.630707115+09:00","created_by":"Z"}]}
{"id":"agi-cnf.20","title":"Rust port: ask_user MCP server","description":"Scope:\n- Implement MCP ask_user server in Rust (stdio transport).\n- Write /tmp/ask-user-\u003cid\u003e.json with same schema.\nDeliverables:\n- ask_user_mcp binary with compatibility tests.","notes":"Review: ensure MCP protocol compatibility; request file schema matches TS; chat_id from env; unique request IDs.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:03:40.739385325+09:00","created_by":"Z","updated_at":"2026-02-02T02:07:46.518834722+09:00","dependencies":[{"issue_id":"agi-cnf.20","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:03:40.74026614+09:00","created_by":"Z"}]}
{"id":"agi-cnf.21","title":"Rust port: docs + parity checklist","description":"Scope:\n- Update README/SECURITY/.env.example for Rust build/run.\n- Write manual parity checklist + smoke test plan.\nDeliverables:\n- Updated docs and checklist.","notes":"Review: include migration notes, service setup for Rust binary, parity checklist + manual smoke tests.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:03:50.868337107+09:00","created_by":"Z","updated_at":"2026-02-02T02:07:58.066680196+09:00","dependencies":[{"issue_id":"agi-cnf.21","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:03:50.869566794+09:00","created_by":"Z"}]}
{"id":"agi-cnf.22","title":"Rust port: command handlers","description":"Scope:\\n- Implement /start, /new, /stop, /status, /stats, /resume, /retry, /cron, /restart.\\n- Format responses and integrate usage/scheduler/session state.\\nDeliverables:\\n- handlers/commands.rs parity with TS.\\n- Command registration wired in bot core.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:10:53.422944801+09:00","created_by":"Z","updated_at":"2026-02-02T02:10:53.422944801+09:00","dependencies":[{"issue_id":"agi-cnf.22","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:10:53.42359199+09:00","created_by":"Z"}]}
{"id":"agi-cnf.3","title":"Rust port: Claude CLI stream-json research + spec","description":"Scope:\n- Run claude CLI in stream-json mode; capture event shapes (assistant/tool/usage/result).\n- Verify flags for permission bypass, session resume, MCP config, input/output formats.\nDeliverables:\n- Stream JSON schema notes + sample fixture.\n- Required CLI flags documented.","notes":"Review: verify stream-json event types for thinking/tool/usage; capture exact flags for permission-mode, mcp-config, add-dir, resume/session-id.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:00:13.770727624+09:00","created_by":"Z","updated_at":"2026-02-02T02:04:48.113390268+09:00","dependencies":[{"issue_id":"agi-cnf.3","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:00:13.771767559+09:00","created_by":"Z"}]}
{"id":"agi-cnf.4","title":"Rust port: workspace scaffolding + logging setup","description":"Scope:\n- Create Cargo workspace/crate layout for bot and optional MCP server.\n- Add tracing/logging and error handling patterns.\nDeliverables:\n- Cargo.toml with base deps.\n- src/ module skeletons compile.","notes":"Review: ensure workspace supports mac/linux; enable tokio full + reqwest rustls; set tracing subscriber defaults.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:00:23.907136574+09:00","created_by":"Z","updated_at":"2026-02-02T02:04:58.258347003+09:00","dependencies":[{"issue_id":"agi-cnf.4","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:00:23.908159968+09:00","created_by":"Z"}]}
{"id":"agi-cnf.5","title":"Rust port: config/env module","description":"Scope:\n- Parse .env and environment variables.\n- PATH injection and temp dir creation.\n- Build safety prompt, constants, allowed paths.\nDeliverables:\n- config.rs with typed settings + validation.\n- Parity with TS defaults.","notes":"Review: confirm env var names/defaults match TS; ALLOWED_PATHS override logic; include message limits + delete flags.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:00:34.053267124+09:00","created_by":"Z","updated_at":"2026-02-02T02:05:09.608616+09:00","dependencies":[{"issue_id":"agi-cnf.5","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:00:34.055402529+09:00","created_by":"Z"}]}
{"id":"agi-cnf.6","title":"Rust port: security module","description":"Scope:\n- Token-bucket rate limiter.\n- Path validation with symlink resolution + temp path allowlist.\n- Command safety checks for rm + blocked patterns.\nDeliverables:\n- security.rs with tests for edge cases.","notes":"Review: test symlink + .. traversal; rm arg parsing; ~ expansion; temp path allowlist.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:00:45.349835582+09:00","created_by":"Z","updated_at":"2026-02-02T02:05:19.729661195+09:00","dependencies":[{"issue_id":"agi-cnf.6","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:00:45.350719751+09:00","created_by":"Z"}]}
{"id":"agi-cnf.7","title":"Rust port: utilities + audit logging","description":"Scope:\n- Audit log writer (JSON/plain text) with truncation rules.\n- Timestamp helper, typing indicator loop, interrupt helper.\nDeliverables:\n- utils.rs with audit functions.\n- Unit tests for formatting/truncation.","notes":"Review: audit log truncation for large payloads; ensure async file append errors are handled; typing indicator cancellable.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:01:05.661945893+09:00","created_by":"Z","updated_at":"2026-02-02T02:05:29.853865815+09:00","dependencies":[{"issue_id":"agi-cnf.7","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:01:05.662779381+09:00","created_by":"Z"}]}
{"id":"agi-cnf.8","title":"Rust port: session runner A (CLI spawn/resume/cancel)","description":"Scope:\n- Spawn claude CLI with stream-json output.\n- Implement session persistence file + resume logic.\n- Cancellation token for /stop and ! interrupt.\nDeliverables:\n- session.rs core runner that can stream events.\n- Resume/kill flows parity with TS.","notes":"Review: handle claude process exit codes + stderr; support new vs resume sessions; cancellation kills child process cleanly.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:01:16.866314512+09:00","created_by":"Z","updated_at":"2026-02-02T02:05:41.267714901+09:00","dependencies":[{"issue_id":"agi-cnf.8","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:01:16.867055102+09:00","created_by":"Z"}]}
{"id":"agi-cnf.9","title":"Rust port: session runner B (event handling/usage)","description":"Scope:\n- Parse stream events into thinking/tool/text segments.\n- Tool safety checks (Bash + file ops).\n- Usage accumulation + ask_user trigger hooks.\nDeliverables:\n- Event pipeline wired to status callback.\n- Token usage counters parity.","notes":"Review: parse partial events; ensure ask_user tool triggers button flow; clear stopRequested after interrupts; flush queued cron jobs after completion.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:01:26.994956107+09:00","created_by":"Z","updated_at":"2026-02-02T02:05:51.394914633+09:00","dependencies":[{"issue_id":"agi-cnf.9","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:01:26.995848987+09:00","created_by":"Z"}]}
{"id":"agi-e5r","title":"Create multi-provider usage utility module (src/usage.ts)","description":"Create a new module to fetch usage statistics from Claude Code, OpenAI Codex, and Gemini CLI.\n\n## Source Reference\nBased on https://github.com/zhugehyuk-contributions/claude-dashboard code patterns.\n\n## Implementation Details\n\n### Claude Code Usage (api-client.ts pattern)\n- API: GET https://api.anthropic.com/api/oauth/usage\n- Auth: Bearer token from ~/.claude/.credentials.json or macOS Keychain\n- Response: five_hour, seven_day, seven_day_sonnet (utilization %, reset time)\n\n### OpenAI Codex Usage (codex-client.ts pattern)\n- API: GET https://chatgpt.com/backend-api/wham/usage\n- Auth: Bearer token + account ID from ~/.codex/auth.json\n- Response: primary_window (5h), secondary_window (7d) with used_percent, reset times\n\n### Gemini Usage (gemini-client.ts pattern)\n- API: POST https://cloudcode-pa.googleapis.com/v1internal:retrieveUserQuota\n- Auth: OAuth token from macOS Keychain or ~/.gemini/oauth_creds.json\n- Response: buckets with remainingFraction, resetTime per model\n\n## Functions to implement\n- fetchClaudeUsage(): Promise\u003cClaudeUsage | null\u003e\n- fetchCodexUsage(): Promise\u003cCodexUsage | null\u003e\n- fetchGeminiUsage(): Promise\u003cGeminiUsage | null\u003e\n- fetchAllUsage(): Promise\u003cAllUsage\u003e (parallel fetch all)\n\n## Caching\n- In-memory cache with configurable TTL (default 60s)\n- Deduplicate concurrent requests","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:31:30.564745923+09:00","created_by":"Z","updated_at":"2026-02-02T01:33:29.393259141+09:00","closed_at":"2026-02-02T01:33:29.393259141+09:00","close_reason":"Closed","dependencies":[{"issue_id":"agi-e5r","depends_on_id":"agi-ix4","type":"blocks","created_at":"2026-02-02T01:31:59.776456518+09:00","created_by":"Z"}]}
{"id":"agi-ey6","title":"Add preflight service check before restart in make up","description":"Improve make up reliability with preflight checks before service restart\n\nCurrent: make up â†’ install â†’ build â†’ restart service\nProblem: If build fails, service is already stopped/restarted\n\nGoal: make up â†’ install â†’ build â†’ preflight check â†’ restart if OK\n\nImplementation:\n1. Add preflight target to Makefile\n2. Preflight checks:\n   - bun run typecheck passes\n   - No critical lint errors\n   - Service configuration valid\n3. Only restart service if all preflight checks pass\n4. Show clear error messages if preflight fails\n\nBenefits:\n- Prevents broken deployments\n- Service stays running if new code is broken\n- Clear feedback on what failed","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:41:27.927075357+09:00","created_by":"Z","updated_at":"2026-02-02T01:41:44.675602588+09:00"}
{"id":"agi-gi2","title":"Research: Claude Code context window usage \u0026 subscription weekly usage API","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:15:06.917549891+09:00","created_by":"Z","updated_at":"2026-02-02T01:19:17.485455809+09:00","closed_at":"2026-02-02T01:19:17.485455809+09:00","close_reason":"Closed"}
{"id":"agi-ix4","title":"Add usage types to src/types.ts","description":"Add TypeScript types for multi-provider usage data.\n\n## Types to add\n\n```typescript\n// Claude usage from oauth/usage endpoint\ninterface ClaudeUsage {\n  five_hour: { utilization: number; resets_at: string | null } | null;\n  seven_day: { utilization: number; resets_at: string | null } | null;\n  seven_day_sonnet: { utilization: number; resets_at: string | null } | null;\n}\n\n// Codex usage from ChatGPT backend\ninterface CodexUsage {\n  model: string;\n  planType: string;\n  primary: { usedPercent: number; resetAt: number } | null;\n  secondary: { usedPercent: number; resetAt: number } | null;\n}\n\n// Gemini usage from Code Assist API\ninterface GeminiUsage {\n  model: string;\n  usedPercent: number | null;\n  resetAt: string | null;\n}\n\n// Combined usage result\ninterface AllUsage {\n  claude: ClaudeUsage | null;\n  codex: CodexUsage | null;\n  gemini: GeminiUsage | null;\n  fetchedAt: number;\n}\n```","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:31:39.407631055+09:00","created_by":"Z","updated_at":"2026-02-02T01:32:33.226229237+09:00","closed_at":"2026-02-02T01:32:33.226229237+09:00","close_reason":"Closed"}
{"id":"agi-p62","title":"cron job queue system","description":"Implement cron job queue system to prevent jobs from being skipped when session is busy.\n\nCurrently: Cron jobs are skipped if session.isRunning\nGoal: Queue pending cron jobs and execute them when session becomes idle\n\nTasks:\n- [ ] Add pendingCronJobs queue to scheduler.ts (Array\u003c{schedule, timestamp}\u003e)\n- [ ] Modify executeScheduledPrompt: push to queue if session busy\n- [ ] Add processQueuedJobs() function to execute queued jobs\n- [ ] Hook into session completion to call processQueuedJobs()\n- [ ] Add queue status to /cron command output\n- [ ] Test: schedule job while session busy, verify it executes after","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T00:58:04.48459361+09:00","created_by":"Z","updated_at":"2026-02-02T01:09:23.480881355+09:00","closed_at":"2026-02-02T01:09:23.480881355+09:00","close_reason":"Closed"}
{"id":"agi-qzd","title":"Critical: Shell injection in save-and-restart.sh","description":"Security: Shell injection vulnerability in save-and-restart.sh\n\nLocation: save-and-restart.sh:16-25\n\nIssue: MESSAGE variable injected into heredoc without sanitization\nAttack: Message containing EOF or shell metacharacters can break out and execute arbitrary commands\n\nExample attack:\n./save-and-restart.sh 'EOF\n$(rm -rf ~)\ncat \u003c\u003cEOF'\n\nFix: Use quoted heredoc ('EOF') or printf instead of interpolation","status":"closed","priority":0,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:56:05.464760174+09:00","created_by":"Z","updated_at":"2026-02-02T02:10:26.354345237+09:00","closed_at":"2026-02-02T02:10:26.354345237+09:00","close_reason":"Closed"}
{"id":"agi-uey","title":"Fix make up to include service restart","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T00:15:12.002555983+09:00","created_by":"Z","updated_at":"2026-02-02T01:03:23.064613675+09:00","closed_at":"2026-02-02T00:20:06.929627814+09:00","close_reason":"Closed"}
{"id":"agi-vv1","title":"Real-time steering: inject user messages during Claude execution","description":"## ê¸°ëŠ¥\nì‚¬ìš©ìê°€ Claude ì‹¤í–‰ ì¤‘ì— ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì „ë‹¬í•˜ì—¬ í–‰ë™ì„ steering\n\n## ì¡°ì‚¬ ê²°ê³¼\n\n### SDK ì§€ì›\n- V1 API: `interrupt()` ë©”ì„œë“œ + AsyncGenerator íŒ¨í„´\n- V2 API: `streamInput()` ìˆìœ¼ë‚˜ unstable\n- Hooks API: `PreToolUse` hookìœ¼ë¡œ ì»¨í…ìŠ¤íŠ¸ ì£¼ì… ê°€ëŠ¥\n\n### ê¶Œì¥ ì•„í‚¤í…ì²˜: Hook Injection + Interrupt\n```\nì¼ë°˜ ë©”ì‹œì§€ (ì‹¤í–‰ ì¤‘) â†’ ë²„í¼ì— ì¶”ê°€ â†’ ë‹¤ìŒ tool í˜¸ì¶œ ì „ ì£¼ì…\n! prefix â†’ ê¸°ì¡´ì²˜ëŸ¼ abort + ìƒˆ ì¿¼ë¦¬\n!! prefix â†’ hard interrupt (ì¦‰ì‹œ ì¤‘ë‹¨)\n```\n\n### êµ¬í˜„ ë°©ë²•\n1. SteeringBuffer í´ë˜ìŠ¤ ìƒì„±\n2. PreToolUse hookì—ì„œ ë²„í¼ëœ ë©”ì‹œì§€ë¥¼ additionalContextë¡œ ì£¼ì…\n3. ê¸°ì¡´ ! interrupt ìœ ì§€\n\n### ì°¸ê³ \n- GitHub Issue #70: Real-time steering (closed/completed)\n- GitHub Issue #120: V2 interrupt (open)\n- Tool use ì¤‘ interrupt ì‹œ ì—ëŸ¬ ê°€ëŠ¥ì„± ìˆìŒ (Issue #12162)","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:10:15.867941209+09:00","created_by":"Z","updated_at":"2026-02-02T01:10:15.867941209+09:00"}
{"id":"agi-wdq","title":"message reaction indicators for turn tracking","description":"Add message reactions to indicate conversation turn status.\n\nProblem: User can't tell when Claude has received and is processing their message, or when Claude's turn is complete.\n\nSolution:\n1. When user message received â†’ Add reaction (ğŸ‘€ or â³) to user's message\n2. When Claude finishes turn â†’ Add reaction (âœ…) to Claude's last message\n\nImplementation:\n- Use Telegram setMessageReaction API\n- Add reaction to user message in message handlers\n- Add reaction to bot's last message when turn complete","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T00:59:57.144000709+09:00","created_by":"Z","updated_at":"2026-02-02T01:06:17.441973632+09:00","closed_at":"2026-02-02T01:06:17.441973632+09:00","close_reason":"Closed"}
{"id":"agi-xd7","title":"make up with context message for restart continuity","description":"Feature: Accept context message in make up command\n\nUsage:\nmake up \"current context and next tasks\"\n\nWorkflow:\n1. Before restart: Use oh-my-claude:save skill to save context\n2. Run make up to restart bot\n3. After restart: Auto-load saved context using oh-my-claude:load skill\n\nImplementation:\n- Modify Makefile to accept optional message parameter\n- Save message to docs/tasks/save/ before restart\n- On startup, check for saved context file\n- Notify user to use /load skill or auto-load\n\nGoal: Preserve conversation context across bot restarts","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:27:14.707652686+09:00","created_by":"Z","updated_at":"2026-02-02T01:36:53.259037784+09:00","closed_at":"2026-02-02T01:36:53.259037784+09:00","close_reason":"Closed"}
{"id":"agi-y86","title":"Progress spinner for work status","description":"ì‘ì—… ì§„í–‰ì¤‘ ë©”ì‹œì§€ í•˜ë‹¨ì— ìŠ¤í”¼ë„ˆ í‘œì‹œ:\n1. í˜„ì¬ ì‘ì—… ì§„í–‰ ìƒíƒœë¥¼ ë§¨ ë§ˆì§€ë§‰ ë©”ì‹œì§€ë¡œ í‘œì‹œ\n2. ì‹œê°„ í‘œì‹œ ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸\n3. ì‘ì—… ì™„ë£Œì‹œ: ì‹œì‘ì‹œê°„, ì¢…ë£Œì‹œê°„, ì†Œìš”ì‹œê°„(ë¶„:ì´ˆ) í‘œì‹œ\n4. êµ¬í˜„ í›„ make upìœ¼ë¡œ ì¬ì‹œì‘ê¹Œì§€ ì™„ë£Œ","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:04:17.150770594+09:00","created_by":"Z","updated_at":"2026-02-02T01:13:13.891376626+09:00","closed_at":"2026-02-02T01:13:13.891376626+09:00","close_reason":"Closed"}
{"id":"agi-zpw","title":"Fix: Progress timer race condition in streaming.ts","description":"Race condition: Timer may edit deleted progress message\n\nLocation: src/handlers/streaming.ts:158-177\n\nIssue: state.progressMessage can be mutated by recreateProgressMessage() while timer's async editMessageText is pending. Timer may hold stale reference.\n\nImpact: Intermittent 'message not found' errors from Telegram API\n\nFix: Capture message reference at start of timer callback and verify hasn't changed","status":"closed","priority":1,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:47:55.928136054+09:00","created_by":"Z","updated_at":"2026-02-02T01:52:35.232519955+09:00","closed_at":"2026-02-02T01:52:35.232519955+09:00","close_reason":"Closed"}
