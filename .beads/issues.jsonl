{"id":"agi-02p","title":"Unbounded queue growth in cron scheduler","description":"Security: pendingCronJobs queue grows without bound\n\nLocation: src/scheduler.ts:26, 104-106\n\nIssue: No max queue size limit. Jobs queue faster than execution\nImpact: Memory exhaustion if bot busy for extended period\n\nFix: Add max queue size (e.g., 100), reject or discard oldest when full","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:56:44.643292886+09:00","created_by":"Z","updated_at":"2026-02-02T02:10:26.363263772+09:00","closed_at":"2026-02-02T02:10:26.363263772+09:00","close_reason":"Closed"}
{"id":"agi-077","title":"Rename bd prefix to 9yr","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T00:21:19.656433209+09:00","created_by":"Z","updated_at":"2026-02-02T01:03:29.873565616+09:00","closed_at":"2026-02-02T01:03:29.873565616+09:00","close_reason":"Closed"}
{"id":"agi-14p","title":"make up fails when service not installed - need fallback for dev mode","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T00:31:00.298338736+09:00","created_by":"Z","updated_at":"2026-02-02T01:03:23.063988473+09:00","closed_at":"2026-02-02T00:35:05.846589507+09:00","close_reason":"Closed"}
{"id":"agi-30z","title":"Fix: handleRetry missing ctx.message undefined check","description":"Missing undefined check in handleRetry command\n\nLocation: src/handlers/commands.ts:467-506\n\nIssue: Creates fake context by spreading ctx.message which could be undefined in edge cases\n\nImpact: Potential crash when ctx.message is undefined\n\nFix: Add guard check before spreading ctx.message","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:48:14.256348813+09:00","created_by":"Z","updated_at":"2026-02-02T01:52:35.234822399+09:00","closed_at":"2026-02-02T01:52:35.234822399+09:00","close_reason":"Closed"}
{"id":"agi-5eb","title":"fix: spinner recreates itself on timer (infinite delete/create)","description":"Bug: Timer interval recreates spinner every second instead of editing\n\nCurrent broken logic:\n- Timer calls recreateProgressMessage() every 1s\n- recreateProgressMessage = DELETE + CREATE new message\n- Result: Spinner constantly deleted/recreated (flashing)\n\nCorrect logic should be:\n- Timer: EDIT existing message (update text only)\n- New output added: DELETE + CREATE (move to bottom)\n\nFix:\n1. Timer should use editMessageText (not delete/create)\n2. Only recreate when new messages are added\n3. Recreate = delete old + create new at bottom","status":"closed","priority":1,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:26:56.019383359+09:00","created_by":"Z","updated_at":"2026-02-02T01:28:35.979823832+09:00","closed_at":"2026-02-02T01:28:35.979823832+09:00","close_reason":"Closed"}
{"id":"agi-5kf","title":"Fix: recreateProgressMessage uncaught promise in initialization","description":"Uncaught promise during progress message initialization\n\nLocation: src/handlers/streaming.ts:154-155\n\nIssue: recreateProgressMessage() called without await, fire-and-forget. Errors may not propagate.\n\nImpact: Silent failures during initialization\n\nFix: Add await or explicit error handling, or document intentional fire-and-forget","status":"closed","priority":3,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:48:29.59035452+09:00","created_by":"Z","updated_at":"2026-02-02T01:52:35.236472574+09:00","closed_at":"2026-02-02T01:52:35.236472574+09:00","close_reason":"Closed"}
{"id":"agi-6u4","title":"Critical: Progress timer needs per-conversation tracking","description":"Oracle found: Global progressInterval will clobber across multiple conversations\n\nIssue: StreamingState is per-message but progressInterval is global\nImpact: Multiple concurrent conversations will overwrite each other's timers\nRisk: Orphaned intervals, memory leaks, wrong chat getting updates\n\nFix: Use Map\u003cchatId, {interval, startTime}\u003e with 5-minute max timeout","status":"closed","priority":1,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:54:33.142349425+09:00","created_by":"Z","updated_at":"2026-02-02T02:10:40.327604327+09:00","closed_at":"2026-02-02T02:10:40.327604327+09:00","close_reason":"Closed"}
{"id":"agi-8uk","title":"Timer resource leak on error paths in streaming","description":"Security: progressTimer never cleared if error occurs before 'done'\n\nLocation: src/handlers/streaming.ts:159-183\n\nIssue: Timer started but only cleared when statusType==='done'. If error occurs before done, timer leaks\nImpact: Resource exhaustion over time with repeated failures\n\nFix: Add cleanup in error handlers, finally blocks, or max timeout","status":"closed","priority":1,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:56:26.057388317+09:00","created_by":"Z","updated_at":"2026-02-02T02:10:26.361441198+09:00","closed_at":"2026-02-02T02:10:26.361441198+09:00","close_reason":"Closed"}
{"id":"agi-a1s","title":"Integrate multi-provider usage into /stats command","description":"Update handleStats in src/handlers/commands.ts to display Claude, Codex, and Gemini usage.\n\n## Display Format\n\n```\nüìä Session Statistics\n\n... (existing session stats) ...\n\nüåê Provider Usage\n\nClaude Code:\n   5h: 45% (resets in 2h 15m)\n   7d: 12% (resets in 5d 3h)\n\nOpenAI Codex (plus):\n   5h: 30% (resets in 1h 45m)\n   7d: 8% (resets in 6d 12h)\n\nGemini (gemini-2.0-flash):\n   Usage: 25% (resets in 4h)\n```\n\n## Implementation\n1. Call fetchAllUsage() at start of handler\n2. Format each provider's usage with percentage and reset time\n3. Skip providers that return null (not installed/authenticated)\n4. Show loading indicator or cache status","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:31:48.508641909+09:00","created_by":"Z","updated_at":"2026-02-02T01:35:16.194224801+09:00","closed_at":"2026-02-02T01:35:16.194224801+09:00","close_reason":"Closed","dependencies":[{"issue_id":"agi-a1s","depends_on_id":"agi-e5r","type":"blocks","created_at":"2026-02-02T01:31:59.801718889+09:00","created_by":"Z"}]}
{"id":"agi-cnf","title":"Port to Rust","description":"Plan and execute a full port of the TypeScript Telegram bot to Rust, including architecture, feature parity, and deployment.","status":"in_progress","priority":2,"issue_type":"epic","owner":"z@2lab.ai","created_at":"2026-02-02T01:52:10.21969328+09:00","created_by":"Z","updated_at":"2026-02-02T01:53:34.179762594+09:00"}
{"id":"agi-cnf.10","title":"Rust port: formatting module","description":"Scope:\n- Markdown -\u003e Telegram HTML conversion.\n- Tool status formatting (emoji + truncation).\nDeliverables:\n- formatting.rs with tests covering edge cases.","notes":"Implementing Rust formatting module: Markdown-\u003eTelegram HTML + tool status formatting + tests\nImplemented Rust formatting module in rust/crates/ctb-core/src/formatting.rs: escape_html(), convert_markdown_to_html() (code blocks, inline code, headers/bold/italic, blockquotes, bullets, links, newline collapse), and format_tool_status() with emoji/truncation. Added unit tests.","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:01:37.131597449+09:00","created_by":"Z","updated_at":"2026-02-02T09:20:01.687868331+09:00","closed_at":"2026-02-02T09:20:01.687868331+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.10","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:01:37.132603841+09:00","created_by":"Z"},{"issue_id":"agi-cnf.10","depends_on_id":"agi-cnf.4","type":"blocks","created_at":"2026-02-02T02:16:36.600524772+09:00","created_by":"Z"}]}
{"id":"agi-cnf.11","title":"Rust port: streaming state module","description":"Scope:\n- Message segmentation + edit throttling.\n- Progress spinner timer + completion message.\n- Delete thinking/tool messages based on config; add reaction on completion.\nDeliverables:\n- streaming.rs state + status callback implementation.","notes":"Implementing streaming state module for Rust port (segmentation, throttled edits, progress timer, delete flags)\nImplemented streaming state module in rust/crates/ctb-core/src/streaming.rs: per-segment message tracking, throttled edits, progress spinner (tick), progress message recreation to bottom, final completion message, delete thinking/tool messages per config, completion reaction. Includes unit tests with fake messenger.","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:01:48.527392763+09:00","created_by":"Z","updated_at":"2026-02-02T09:25:36.910480656+09:00","closed_at":"2026-02-02T09:25:36.910480656+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.11","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:01:48.528201928+09:00","created_by":"Z"},{"issue_id":"agi-cnf.11","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:17:29.64569154+09:00","created_by":"Z"},{"issue_id":"agi-cnf.11","depends_on_id":"agi-cnf.10","type":"blocks","created_at":"2026-02-02T02:19:56.223730669+09:00","created_by":"Z"}]}
{"id":"agi-cnf.12","title":"Rust port: bot core + routing","description":"Scope:\\n- Teloxide bot init + dispatcher + error handler.\\n- Per-chat sequentialization for non-command messages.\\n- Startup/resume/restart notifications.\\n- Command registration wiring (logic in command handlers task).\\nDeliverables:\\n- main.rs + handlers::mod wired.","notes":"Review: sequentialize only non-command/non-! messages; callbacks bypass queue; startup resume + restart message update.","status":"open","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:02:07.893717767+09:00","created_by":"Z","updated_at":"2026-02-02T02:13:13.576385061+09:00","labels":["phase:3"],"dependencies":[{"issue_id":"agi-cnf.12","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:02:07.894575231+09:00","created_by":"Z"},{"issue_id":"agi-cnf.12","depends_on_id":"agi-cnf.9","type":"blocks","created_at":"2026-02-02T02:21:46.966678496+09:00","created_by":"Z"},{"issue_id":"agi-cnf.12","depends_on_id":"agi-cnf.27","type":"blocks","created_at":"2026-02-02T02:44:14.921161702+09:00","created_by":"Z"}]}
{"id":"agi-cnf.13","title":"Rust port: text handler","description":"Scope:\\n- Auth + rate limit + ! interrupt flow.\\n- Start typing indicator; stream response; retry on Claude crash (only).\\n- Error flow: abort/cancel =\u003e stop message; other errors =\u003e truncated error reply.\\n- Cleanup: stop typing + processing flag always.\\nDeliverables:\\n- handlers/text.rs parity with TS flow + error paths.","notes":"Review: rate limit before heavy work; retry only on claude crash; audit log original user text; interrupt flow clears stopRequested.","status":"open","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:02:19.13550156+09:00","created_by":"Z","updated_at":"2026-02-02T02:32:04.443704979+09:00","labels":["phase:4"],"dependencies":[{"issue_id":"agi-cnf.13","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:02:19.136254843+09:00","created_by":"Z"},{"issue_id":"agi-cnf.13","depends_on_id":"agi-cnf.6","type":"blocks","created_at":"2026-02-02T02:18:11.3644377+09:00","created_by":"Z"},{"issue_id":"agi-cnf.13","depends_on_id":"agi-cnf.7","type":"blocks","created_at":"2026-02-02T02:19:03.191908619+09:00","created_by":"Z"},{"issue_id":"agi-cnf.13","depends_on_id":"agi-cnf.11","type":"blocks","created_at":"2026-02-02T02:20:43.755633841+09:00","created_by":"Z"},{"issue_id":"agi-cnf.13","depends_on_id":"agi-cnf.9","type":"blocks","created_at":"2026-02-02T02:21:58.324487514+09:00","created_by":"Z"},{"issue_id":"agi-cnf.13","depends_on_id":"agi-cnf.12","type":"blocks","created_at":"2026-02-02T02:23:18.269991663+09:00","created_by":"Z"}]}
{"id":"agi-cnf.14","title":"Rust port: voice handler","description":"Scope:\\n- Download voice file and transcribe via OpenAI.\\n- Error flow: no API key, download fail, transcription fail, abort/cancel.\\n- Cleanup: delete temp file on all exits; stop typing + processing flag.\\nDeliverables:\\n- handlers/voice.rs parity with TS + robust cleanup.","notes":"Review: check transcription availability; handle download errors; ensure temp file cleanup on all exits.","status":"open","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:02:29.267172527+09:00","created_by":"Z","updated_at":"2026-02-02T02:32:28.659835074+09:00","labels":["phase:4"],"dependencies":[{"issue_id":"agi-cnf.14","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:02:29.268059452+09:00","created_by":"Z"},{"issue_id":"agi-cnf.14","depends_on_id":"agi-cnf.6","type":"blocks","created_at":"2026-02-02T02:18:21.504506766+09:00","created_by":"Z"},{"issue_id":"agi-cnf.14","depends_on_id":"agi-cnf.7","type":"blocks","created_at":"2026-02-02T02:19:14.520353142+09:00","created_by":"Z"},{"issue_id":"agi-cnf.14","depends_on_id":"agi-cnf.11","type":"blocks","created_at":"2026-02-02T02:20:55.100128692+09:00","created_by":"Z"},{"issue_id":"agi-cnf.14","depends_on_id":"agi-cnf.9","type":"blocks","created_at":"2026-02-02T02:22:08.453579294+09:00","created_by":"Z"},{"issue_id":"agi-cnf.14","depends_on_id":"agi-cnf.12","type":"blocks","created_at":"2026-02-02T02:23:28.395013463+09:00","created_by":"Z"}]}
{"id":"agi-cnf.15","title":"Rust port: photo handler + media group buffer","description":"Scope:\\n- Download photos; buffer albums (1s).\\n- Error flow: download fail, rate limit, Claude errors; status message update/delete.\\n- Cleanup: delete temp photos + tool messages on error.\\nDeliverables:\\n- handlers/photo.rs + media_group.rs parity.","notes":"Review: album buffering uses 1s timeout; caption handling; delete status messages; remove temp photos.","status":"open","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:02:39.425967205+09:00","created_by":"Z","updated_at":"2026-02-02T02:32:43.594022573+09:00","labels":["phase:4"],"dependencies":[{"issue_id":"agi-cnf.15","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:02:39.427521764+09:00","created_by":"Z"},{"issue_id":"agi-cnf.15","depends_on_id":"agi-cnf.6","type":"blocks","created_at":"2026-02-02T02:18:31.632370905+09:00","created_by":"Z"},{"issue_id":"agi-cnf.15","depends_on_id":"agi-cnf.7","type":"blocks","created_at":"2026-02-02T02:19:24.654549596+09:00","created_by":"Z"},{"issue_id":"agi-cnf.15","depends_on_id":"agi-cnf.11","type":"blocks","created_at":"2026-02-02T02:21:05.228167483+09:00","created_by":"Z"},{"issue_id":"agi-cnf.15","depends_on_id":"agi-cnf.9","type":"blocks","created_at":"2026-02-02T02:22:36.553156973+09:00","created_by":"Z"},{"issue_id":"agi-cnf.15","depends_on_id":"agi-cnf.12","type":"blocks","created_at":"2026-02-02T02:23:39.713805432+09:00","created_by":"Z"}]}
{"id":"agi-cnf.16","title":"Rust port: document handler","description":"Scope:\\n- Download docs; detect PDF/text/archive; 10MB limit.\\n- Error flow: unsupported type, extract failure, Claude errors; status message update/delete.\\n- Integrate archive security helpers (see agi-cnf.26).\\nDeliverables:\\n- handlers/document.rs parity + safe extraction.","notes":"Review: enforce 10MB limit; secure archive extraction (no path traversal); cap total extracted content.","status":"open","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:02:50.716534486+09:00","created_by":"Z","updated_at":"2026-02-02T02:32:57.452513674+09:00","labels":["phase:4"],"dependencies":[{"issue_id":"agi-cnf.16","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:02:50.71742603+09:00","created_by":"Z"},{"issue_id":"agi-cnf.16","depends_on_id":"agi-cnf.6","type":"blocks","created_at":"2026-02-02T02:18:42.92633956+09:00","created_by":"Z"},{"issue_id":"agi-cnf.16","depends_on_id":"agi-cnf.7","type":"blocks","created_at":"2026-02-02T02:19:34.779775554+09:00","created_by":"Z"},{"issue_id":"agi-cnf.16","depends_on_id":"agi-cnf.11","type":"blocks","created_at":"2026-02-02T02:21:15.363587428+09:00","created_by":"Z"},{"issue_id":"agi-cnf.16","depends_on_id":"agi-cnf.9","type":"blocks","created_at":"2026-02-02T02:22:46.680982539+09:00","created_by":"Z"},{"issue_id":"agi-cnf.16","depends_on_id":"agi-cnf.12","type":"blocks","created_at":"2026-02-02T02:23:49.851277615+09:00","created_by":"Z"},{"issue_id":"agi-cnf.16","depends_on_id":"agi-cnf.26","type":"blocks","created_at":"2026-02-02T02:34:18.206842394+09:00","created_by":"Z"}]}
{"id":"agi-cnf.17","title":"Rust port: callback handler + ask_user integration","description":"Scope:\\n- Parse callback data; handle missing/expired request file.\\n- Error flow: invalid callback =\u003e answer + return; Claude errors =\u003e stop msg.\\n- Always answer callback; delete request file safely.\\nDeliverables:\\n- handlers/callback.rs parity with TS.","notes":"Review: validate callback data; handle missing/expired request file; always answer callback query; interrupt semantics before sending choice.","status":"open","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:03:09.120630796+09:00","created_by":"Z","updated_at":"2026-02-02T02:33:12.346324526+09:00","labels":["phase:4"],"dependencies":[{"issue_id":"agi-cnf.17","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:03:09.121448806+09:00","created_by":"Z"},{"issue_id":"agi-cnf.17","depends_on_id":"agi-cnf.6","type":"blocks","created_at":"2026-02-02T02:18:53.061150766+09:00","created_by":"Z"},{"issue_id":"agi-cnf.17","depends_on_id":"agi-cnf.7","type":"blocks","created_at":"2026-02-02T02:19:46.092580709+09:00","created_by":"Z"},{"issue_id":"agi-cnf.17","depends_on_id":"agi-cnf.11","type":"blocks","created_at":"2026-02-02T02:21:26.698104636+09:00","created_by":"Z"},{"issue_id":"agi-cnf.17","depends_on_id":"agi-cnf.9","type":"blocks","created_at":"2026-02-02T02:22:56.810500887+09:00","created_by":"Z"},{"issue_id":"agi-cnf.17","depends_on_id":"agi-cnf.12","type":"blocks","created_at":"2026-02-02T02:23:59.972659988+09:00","created_by":"Z"}]}
{"id":"agi-cnf.18","title":"Rust port: cron scheduler","description":"Scope:\n- Parse cron.yaml (yaml).\n- Schedule jobs; queue if session busy; rate limit.\n- Notify user with results.\nDeliverables:\n- scheduler.rs parity with TS.","notes":"Review: cron.yaml path validation; rate limit jobs/hour; queue when session busy; file watcher reload safety.","status":"open","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:03:19.252307001+09:00","created_by":"Z","updated_at":"2026-02-02T02:14:16.867432569+09:00","labels":["phase:3"],"dependencies":[{"issue_id":"agi-cnf.18","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:03:19.253230995+09:00","created_by":"Z"},{"issue_id":"agi-cnf.18","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:17:39.767650803+09:00","created_by":"Z"},{"issue_id":"agi-cnf.18","depends_on_id":"agi-cnf.9","type":"blocks","created_at":"2026-02-02T02:23:08.143657045+09:00","created_by":"Z"}]}
{"id":"agi-cnf.19","title":"Rust port: usage stats module","description":"Scope:\n- Fetch Claude/Codex/Gemini usage with caching.\n- Implement /stats formatting.\nDeliverables:\n- usage.rs parity with TS.","notes":"Review: timeouts for provider API calls; cache TTL behavior; mac keychain fallback to file; handle missing creds gracefully.","status":"open","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:03:30.598056541+09:00","created_by":"Z","updated_at":"2026-02-02T02:14:27.004553274+09:00","labels":["phase:3"],"dependencies":[{"issue_id":"agi-cnf.19","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:03:30.598917606+09:00","created_by":"Z"},{"issue_id":"agi-cnf.19","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:17:49.889884593+09:00","created_by":"Z"}]}
{"id":"agi-cnf.2","title":"Rust port: architecture + crate selection + module map","description":"Scope:\n- Map TS modules to Rust modules (config/security/session/handlers/scheduler/usage/etc).\n- Choose core crates and runtime (teloxide, tokio, reqwest, serde, tracing, etc).\n- Identify parity gaps and risks (Claude CLI vs SDK, MCP config, thinking tokens).\nDeliverables:\n- Module map + data flow notes.\n- Crate list with rationale.\n- Risk list with mitigation ideas.","notes":"Starting Rust port architecture/crate selection + module map\nDelivered architecture + crate selection + module map in docs/rust-port/architecture.md","status":"closed","priority":1,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:00:03.629676818+09:00","created_by":"Z","updated_at":"2026-02-02T03:01:05.648303271+09:00","closed_at":"2026-02-02T03:01:05.648303271+09:00","close_reason":"Closed","labels":["phase:0"],"dependencies":[{"issue_id":"agi-cnf.2","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:00:03.630707115+09:00","created_by":"Z"}]}
{"id":"agi-cnf.20","title":"Rust port: ask_user MCP server","description":"Scope:\n- Implement MCP ask_user server in Rust (stdio transport).\n- Write /tmp/ask-user-\u003cid\u003e.json with same schema.\nDeliverables:\n- ask_user_mcp binary with compatibility tests.","notes":"Review: ensure MCP protocol compatibility; request file schema matches TS; chat_id from env; unique request IDs.","status":"open","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:03:40.739385325+09:00","created_by":"Z","updated_at":"2026-02-02T02:14:38.422406116+09:00","labels":["phase:5"],"dependencies":[{"issue_id":"agi-cnf.20","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:03:40.74026614+09:00","created_by":"Z"},{"issue_id":"agi-cnf.20","depends_on_id":"agi-cnf.4","type":"blocks","created_at":"2026-02-02T02:16:46.77399389+09:00","created_by":"Z"}]}
{"id":"agi-cnf.21","title":"Rust port: docs + parity checklist","description":"Scope:\n- Update README/SECURITY/.env.example for Rust build/run.\n- Write manual parity checklist + smoke test plan.\nDeliverables:\n- Updated docs and checklist.","notes":"Review: include migration notes, service setup for Rust binary, parity checklist + manual smoke tests.","status":"open","priority":4,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:03:50.868337107+09:00","created_by":"Z","updated_at":"2026-02-02T02:14:58.686662233+09:00","labels":["phase:5"],"dependencies":[{"issue_id":"agi-cnf.21","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:03:50.869566794+09:00","created_by":"Z"},{"issue_id":"agi-cnf.21","depends_on_id":"agi-cnf.22","type":"blocks","created_at":"2026-02-02T02:25:06.857137426+09:00","created_by":"Z"},{"issue_id":"agi-cnf.21","depends_on_id":"agi-cnf.20","type":"blocks","created_at":"2026-02-02T02:25:18.222442853+09:00","created_by":"Z"},{"issue_id":"agi-cnf.21","depends_on_id":"agi-cnf.24","type":"blocks","created_at":"2026-02-02T02:28:58.03807873+09:00","created_by":"Z"}]}
{"id":"agi-cnf.22","title":"Rust port: command handlers","description":"Scope:\\n- Implement /start,/new,/stop,/status,/stats,/resume,/retry,/cron,/restart.\\n- Error flow: missing ctx.message for /retry; handle inactive session; guard against running query.\\n- Integrate usage/scheduler/session state formatting.\\nDeliverables:\\n- handlers/commands.rs parity with TS + error handling.","notes":"Review: /retry depends on text handler; /cron requires scheduler; /stats requires usage module; ensure HTML escaping + Telegram length limits in responses.","status":"open","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:10:53.422944801+09:00","created_by":"Z","updated_at":"2026-02-02T02:33:26.365079649+09:00","labels":["phase:3"],"dependencies":[{"issue_id":"agi-cnf.22","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:10:53.42359199+09:00","created_by":"Z"},{"issue_id":"agi-cnf.22","depends_on_id":"agi-cnf.12","type":"blocks","created_at":"2026-02-02T02:24:11.294217531+09:00","created_by":"Z"},{"issue_id":"agi-cnf.22","depends_on_id":"agi-cnf.13","type":"blocks","created_at":"2026-02-02T02:24:21.414478264+09:00","created_by":"Z"},{"issue_id":"agi-cnf.22","depends_on_id":"agi-cnf.18","type":"blocks","created_at":"2026-02-02T02:24:46.59457529+09:00","created_by":"Z"},{"issue_id":"agi-cnf.22","depends_on_id":"agi-cnf.19","type":"blocks","created_at":"2026-02-02T02:24:56.731957252+09:00","created_by":"Z"}]}
{"id":"agi-cnf.23","title":"Rust port: MCP config loader + migration","description":"Scope:\\n- Define Rust-readable MCP config format (json/toml/yaml).\\n- Implement loader + env interpolation for tokens.\\n- Write migration notes from mcp-config.ts to new format.\\nDeliverables:\\n- mcp_config.rs + example config file.","notes":"Implementing Rust-readable MCP config format + loader with env interpolation + migration notes\nImplemented MCP config loader in Rust core: rust/crates/ctb-core/src/mcp_config.rs (JSON schema matching Claude MCP, recursive  interpolation, tests). Added example file mcp-config.example.json and migration notes docs/rust-port/mcp-config-migration.md. Ignored mcp-config.json in .gitignore.","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:26:06.448850627+09:00","created_by":"Z","updated_at":"2026-02-02T09:38:14.829307882+09:00","closed_at":"2026-02-02T09:38:14.829307882+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.23","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:26:06.449738159+09:00","created_by":"Z"},{"issue_id":"agi-cnf.23","depends_on_id":"agi-cnf.4","type":"blocks","created_at":"2026-02-02T02:27:54.507096106+09:00","created_by":"Z"},{"issue_id":"agi-cnf.23","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:28:05.867080027+09:00","created_by":"Z"}]}
{"id":"agi-cnf.24","title":"Rust port: service/deploy scripts","description":"Scope:\\n- Add run scripts/Makefile targets for Rust binary.\\n- Update launchagent/systemd templates for Rust.\\n- Ensure PATH and env loading parity.\\nDeliverables:\\n- Updated Makefile + service templates.","notes":"Review: include PATH injection for pdftotext; service restart semantics; ensure log paths match Rust binary name.","status":"open","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:26:20.275325211+09:00","created_by":"Z","updated_at":"2026-02-02T02:29:36.931233941+09:00","labels":["phase:5"],"dependencies":[{"issue_id":"agi-cnf.24","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:26:20.276326768+09:00","created_by":"Z"},{"issue_id":"agi-cnf.24","depends_on_id":"agi-cnf.12","type":"blocks","created_at":"2026-02-02T02:28:47.897763348+09:00","created_by":"Z"}]}
{"id":"agi-cnf.25","title":"Rust port: parser fixtures + tests","description":"Scope:\\n- Capture stream-json fixtures from claude CLI.\\n- Build parser unit tests for event sequencing (thinking/tool/text/usage/result).\\n- Add regression cases for large outputs and tool blocks.\\nDeliverables:\\n- fixtures/ + tests for session event parsing.","notes":"Review: fixtures should cover tool_use, thinking, partial chunks, errors; test parser handles interleaving + cancellation.","status":"in_progress","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:26:36.927014338+09:00","created_by":"Z","updated_at":"2026-02-02T10:26:50.224671961+09:00","labels":["phase:2"],"dependencies":[{"issue_id":"agi-cnf.25","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:26:36.928074261+09:00","created_by":"Z"},{"issue_id":"agi-cnf.25","depends_on_id":"agi-cnf.3","type":"blocks","created_at":"2026-02-02T02:28:26.135236704+09:00","created_by":"Z"},{"issue_id":"agi-cnf.25","depends_on_id":"agi-cnf.9","type":"blocks","created_at":"2026-02-02T02:28:36.277874239+09:00","created_by":"Z"}]}
{"id":"agi-cnf.26","title":"Rust port: archive extraction security","description":"Scope:\\n- Defend against zip/tar path traversal (../, absolute paths).\\n- Enforce size limits per file and total extracted content.\\n- Ensure extraction dir is temp + cleaned, and only allowed extensions are read.\\nDeliverables:\\n- archive_security.rs helpers + tests.\\n- Guidance for document handler integration.","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:31:40.835460495+09:00","created_by":"Z","updated_at":"2026-02-02T02:33:46.549660112+09:00","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.26","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:31:40.836506843+09:00","created_by":"Z"},{"issue_id":"agi-cnf.26","depends_on_id":"agi-cnf.4","type":"blocks","created_at":"2026-02-02T02:33:56.686671148+09:00","created_by":"Z"},{"issue_id":"agi-cnf.26","depends_on_id":"agi-cnf.6","type":"blocks","created_at":"2026-02-02T02:34:06.824093877+09:00","created_by":"Z"}]}
{"id":"agi-cnf.27","title":"Rust port: messenger abstraction layer","description":"Scope:\\n- Define cross-messenger message model (text/voice/photo/document/command/callback).\\n- Create MessagingPort trait (send/edit/reaction/typing/callback/inline buttons).\\n- Add capability map/feature flags for missing features.\\n- Build Telegram adapter skeleton wiring to port.\\nDeliverables:\\n- messaging/{mod,types,port}.rs + telegram adapter stubs.\\n- Migration notes for adding Slack/Discord/WhatsApp adapters.","notes":"Designing/implementing messenger abstraction (types+port+capabilities) and Telegram adapter skeleton\nImplemented messaging abstraction in Rust core: rust/crates/ctb-core/src/messaging/{mod,types,port}.rs with IncomingUpdate model + InlineKeyboard + MessagingCapabilities + async MessagingPort trait. Updated Telegram adapter stub to implement MessagingPort (rust/crates/ctb-telegram/src/lib.rs). Added migration notes: docs/rust-port/messaging.md.","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:41:46.997307772+09:00","created_by":"Z","updated_at":"2026-02-02T09:30:06.235413033+09:00","closed_at":"2026-02-02T09:30:06.235413033+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.27","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:41:46.998209299+09:00","created_by":"Z"},{"issue_id":"agi-cnf.27","depends_on_id":"agi-cnf.2","type":"blocks","created_at":"2026-02-02T02:43:01.57521216+09:00","created_by":"Z"},{"issue_id":"agi-cnf.27","depends_on_id":"agi-cnf.4","type":"blocks","created_at":"2026-02-02T02:43:23.022118664+09:00","created_by":"Z"},{"issue_id":"agi-cnf.27","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:43:43.29270336+09:00","created_by":"Z"}]}
{"id":"agi-cnf.28","title":"Rust port: model provider abstraction layer","description":"Scope:\\n- Define ModelClient trait with streaming events + capabilities.\\n- Add ModelConfig enum + provider selection (Claude CLI/OpenAI/Gemini/Local).\\n- Implement PromptAdapter for provider-specific system/thinking/tool formatting.\\n- Provide session identity abstraction for resume/restore differences.\\nDeliverables:\\n- model/{mod,types,client}.rs + capability matrix.\\n- Integration notes for swapping models.","notes":"Designing model provider abstraction: ModelClient streaming events, ModelConfig/provider selection, PromptAdapter, session identity\nImplemented model provider abstraction in Rust core: rust/crates/ctb-core/src/model/{mod,types,client}.rs with ProviderKind, SessionRef, ModelCapabilities, ModelConfig, RunRequest/Result, ModelEvent(raw JSON), async ModelClient trait, and ClaudeCliPromptAdapter for argv construction. Updated Claude CLI adapter stub to implement new ModelClient (rust/crates/ctb-claude-cli/src/lib.rs). Added capability/integration notes: docs/rust-port/model.md.","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:42:03.39199771+09:00","created_by":"Z","updated_at":"2026-02-02T09:34:00.415099071+09:00","closed_at":"2026-02-02T09:34:00.415099071+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.28","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:42:03.393052026+09:00","created_by":"Z"},{"issue_id":"agi-cnf.28","depends_on_id":"agi-cnf.2","type":"blocks","created_at":"2026-02-02T02:43:11.734829144+09:00","created_by":"Z"},{"issue_id":"agi-cnf.28","depends_on_id":"agi-cnf.4","type":"blocks","created_at":"2026-02-02T02:43:33.155226518+09:00","created_by":"Z"},{"issue_id":"agi-cnf.28","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:43:54.631826216+09:00","created_by":"Z"},{"issue_id":"agi-cnf.28","depends_on_id":"agi-cnf.3","type":"blocks","created_at":"2026-02-02T02:44:04.776141249+09:00","created_by":"Z"}]}
{"id":"agi-cnf.3","title":"Rust port: Claude CLI stream-json research + spec","description":"Scope:\n- Run claude CLI in stream-json mode; capture event shapes (assistant/tool/usage/result).\n- Verify flags for permission bypass, session resume, MCP config, input/output formats.\nDeliverables:\n- Stream JSON schema notes + sample fixture.\n- Required CLI flags documented.","notes":"Investigating claude CLI --stream-json event schema/flags for Rust port\nCaptured stream-json schema/flags notes in docs/rust-port/claude-cli-stream-json.md and fixture in docs/rust-port/fixtures/claude-stream-json.sample.jsonl (includes system:init, assistant, result). Also confirmed CLAUDE_CONFIG_DIR is required in sandbox/service contexts.","status":"closed","priority":1,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:00:13.770727624+09:00","created_by":"Z","updated_at":"2026-02-02T03:13:02.256821292+09:00","closed_at":"2026-02-02T03:13:02.256821292+09:00","close_reason":"Closed","labels":["phase:0"],"dependencies":[{"issue_id":"agi-cnf.3","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:00:13.771767559+09:00","created_by":"Z"}]}
{"id":"agi-cnf.4","title":"Rust port: workspace scaffolding + logging setup","description":"Scope:\n- Create Cargo workspace/crate layout for bot and optional MCP server.\n- Add tracing/logging and error handling patterns.\nDeliverables:\n- Cargo.toml with base deps.\n- src/ module skeletons compile.","notes":"Scaffolding Rust Cargo workspace + tracing/logging/error patterns\nImplemented Rust workspace scaffolding under rust/ with crates (ctb, ctb-core, ctb-telegram, ctb-claude-cli, ctb-openai). Added error/logging patterns (ctb-core::errors + logging). Workspace compiles (cargo check --workspace).","status":"closed","priority":1,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:00:23.907136574+09:00","created_by":"Z","updated_at":"2026-02-02T09:01:27.143929874+09:00","closed_at":"2026-02-02T09:01:27.143929874+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.4","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:00:23.908159968+09:00","created_by":"Z"},{"issue_id":"agi-cnf.4","depends_on_id":"agi-cnf.2","type":"blocks","created_at":"2026-02-02T02:16:05.051764295+09:00","created_by":"Z"}]}
{"id":"agi-cnf.5","title":"Rust port: config/env module","description":"Scope:\n- Parse .env and environment variables.\n- PATH injection and temp dir creation.\n- Build safety prompt, constants, allowed paths.\nDeliverables:\n- config.rs with typed settings + validation.\n- Parity with TS defaults.","notes":"Implementing typed config/env module for Rust port (parity with TS defaults)\nAdded typed config module in Rust core: rust/crates/ctb-core/src/config.rs (env + optional .env, PATH injection, temp dir creation, safety prompt, limits/flags, parity with TS defaults).","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:00:34.053267124+09:00","created_by":"Z","updated_at":"2026-02-02T09:05:40.868417339+09:00","closed_at":"2026-02-02T09:05:40.868417339+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.5","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:00:34.055402529+09:00","created_by":"Z"},{"issue_id":"agi-cnf.5","depends_on_id":"agi-cnf.4","type":"blocks","created_at":"2026-02-02T02:16:26.477472547+09:00","created_by":"Z"}]}
{"id":"agi-cnf.6","title":"Rust port: security module","description":"Scope:\n- Token-bucket rate limiter.\n- Path validation with symlink resolution + temp path allowlist.\n- Command safety checks for rm + blocked patterns.\nDeliverables:\n- security.rs with tests for edge cases.","notes":"Implementing Rust security module: token bucket, path validation, command safety + tests\nImplemented Rust security module in rust/crates/ctb-core/src/security.rs: auth allowlist, token-bucket rate limiter, path validation (canonicalize+.. normalization, temp allowlist, ~ expansion incl allowed list), rm command safety + blocked patterns. Added unit tests for symlink escape, traversal, rm parsing, tilde, rate limiter.","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:00:45.349835582+09:00","created_by":"Z","updated_at":"2026-02-02T09:09:45.390236419+09:00","closed_at":"2026-02-02T09:09:45.390236419+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.6","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:00:45.350719751+09:00","created_by":"Z"},{"issue_id":"agi-cnf.6","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:16:58.07589677+09:00","created_by":"Z"}]}
{"id":"agi-cnf.7","title":"Rust port: utilities + audit logging","description":"Scope:\n- Audit log writer (JSON/plain text) with truncation rules.\n- Timestamp helper, typing indicator loop, interrupt helper.\nDeliverables:\n- utils.rs with audit functions.\n- Unit tests for formatting/truncation.","notes":"Implementing Rust utilities + audit logging with truncation rules and tests\nAdded Rust utilities + audit logging in rust/crates/ctb-core/src/utils.rs: RFC3339 timestamp helper, add_timestamp(), interrupt prefix helper, cancellable interval loop, AuditLogger (json/plain) with 500-char truncation + recursive JSON truncation, and unit tests.","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:01:05.661945893+09:00","created_by":"Z","updated_at":"2026-02-02T09:14:27.598505039+09:00","closed_at":"2026-02-02T09:14:27.598505039+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.7","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:01:05.662779381+09:00","created_by":"Z"},{"issue_id":"agi-cnf.7","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:17:08.205231978+09:00","created_by":"Z"}]}
{"id":"agi-cnf.8","title":"Rust port: session runner A (CLI spawn/resume/cancel)","description":"Scope:\n- Spawn claude CLI with stream-json output.\n- Implement session persistence file + resume logic.\n- Cancellation token for /stop and ! interrupt.\nDeliverables:\n- session.rs core runner that can stream events.\n- Resume/kill flows parity with TS.","notes":"Implementing Rust session runner A: spawn claude CLI stream-json, session persistence/resume, cancellation (stop/interrupt)\nImplemented Claude CLI runner + session persistence/cancel: ctb-claude-cli spawns claude in print+stream-json mode, streams NDJSON events to callback, extracts session/result/usage, and supports cancel() (kills child). Added provider-agnostic session manager in ctb-core (rust/crates/ctb-core/src/session.rs) that persists session file, supports resume_last(), stop() and interrupt flag flow, and injects date/time + thinking token selection parity.","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:01:16.866314512+09:00","created_by":"Z","updated_at":"2026-02-02T09:52:44.944895409+09:00","closed_at":"2026-02-02T09:52:44.944895409+09:00","close_reason":"Closed","labels":["phase:2"],"dependencies":[{"issue_id":"agi-cnf.8","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:01:16.867055102+09:00","created_by":"Z"},{"issue_id":"agi-cnf.8","depends_on_id":"agi-cnf.3","type":"blocks","created_at":"2026-02-02T02:16:15.188163377+09:00","created_by":"Z"},{"issue_id":"agi-cnf.8","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:17:18.334408476+09:00","created_by":"Z"},{"issue_id":"agi-cnf.8","depends_on_id":"agi-cnf.23","type":"blocks","created_at":"2026-02-02T02:28:15.999586844+09:00","created_by":"Z"},{"issue_id":"agi-cnf.8","depends_on_id":"agi-cnf.28","type":"blocks","created_at":"2026-02-02T02:44:26.188941757+09:00","created_by":"Z"}]}
{"id":"agi-cnf.9","title":"Rust port: session runner B (event handling/usage)","description":"Scope:\n- Parse stream events into thinking/tool/text segments.\n- Tool safety checks (Bash + file ops).\n- Usage accumulation + ask_user trigger hooks.\nDeliverables:\n- Event pipeline wired to status callback.\n- Token usage counters parity.","notes":"Review: parse partial events; ensure ask_user tool triggers button flow; clear stopRequested after interrupts; flush queued cron jobs after completion.\nImplemented session runner B in Rust core: added ClaudeSession::send_message_to_chat(chat_id, prompt, messenger) which runs the model while a background EventPipeline parses stream-json ModelEvent into thinking/tool/text/segment_end/done updates via StreamingState, with a 1s progress spinner tick. Enforced safety checks for Bash commands and Read/Write/Edit file paths using ctb-core security, and emit user-visible BLOCKED / Access denied tool messages before cancelling. Added cumulative token usage accumulation (parity with TS) and an ask_user hook: when mcp__ask-user tool is used, scan /tmp/ask-user-*.json, send inline keyboard, mark file as sent, then cancel the run and return Waiting for user selection.","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:01:26.994956107+09:00","created_by":"Z","updated_at":"2026-02-02T10:26:31.782759446+09:00","closed_at":"2026-02-02T10:26:31.782759446+09:00","close_reason":"Closed","labels":["phase:2"],"dependencies":[{"issue_id":"agi-cnf.9","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:01:26.995848987+09:00","created_by":"Z"},{"issue_id":"agi-cnf.9","depends_on_id":"agi-cnf.6","type":"blocks","created_at":"2026-02-02T02:18:01.221031865+09:00","created_by":"Z"},{"issue_id":"agi-cnf.9","depends_on_id":"agi-cnf.10","type":"blocks","created_at":"2026-02-02T02:20:23.482590239+09:00","created_by":"Z"},{"issue_id":"agi-cnf.9","depends_on_id":"agi-cnf.11","type":"blocks","created_at":"2026-02-02T02:20:33.617695742+09:00","created_by":"Z"},{"issue_id":"agi-cnf.9","depends_on_id":"agi-cnf.8","type":"blocks","created_at":"2026-02-02T02:21:36.831570292+09:00","created_by":"Z"},{"issue_id":"agi-cnf.9","depends_on_id":"agi-cnf.28","type":"blocks","created_at":"2026-02-02T02:44:36.323481839+09:00","created_by":"Z"}]}
{"id":"agi-do5","title":"Research: Telegram rate limit ÏÇ¨Ï†Ñ Í∞êÏßÄ/Í≤ΩÍ≥† ÏãúÏä§ÌÖú","notes":"## Î∞∞Í≤Ω\n- Telegram API 429 ÏóêÎü¨Í∞Ä Î∞úÏÉùÌïú ÌõÑÏóêÏïº rate limit Ïù∏ÏßÄ\n- retry_after: 880Ï¥à (14Î∂Ñ) ÎåÄÍ∏∞ ÌïÑÏöî\n- ÏÇ¨Ïö©Ïûê Í≤ΩÌóò Ï†ÄÌïò\n\n## Î¶¨ÏÑúÏπò Ìï≠Î™©\n1. Telegram API rate limit Ï†ïÏ±Ö Ï°∞ÏÇ¨\n   - Î©îÏãúÏßÄ/Î∂Ñ Ï†úÌïú\n   - editMessage vs sendMessage Ï∞®Ïù¥\n   - Ï±ÑÌåÖÎ≥Ñ vs Î¥áÎ≥Ñ Ï†úÌïú\n\n2. ÏÇ¨Ï†Ñ Í∞êÏßÄ Î∞©Î≤ï\n   - Î©îÏãúÏßÄ Ïπ¥Ïö¥ÌÑ∞ Íµ¨ÌòÑ\n   - Ïä¨ÎùºÏù¥Îî© ÏúàÎèÑÏö∞ Î∞©Ïãù\n   - ÏûÑÍ≥ÑÍ∞í ÎèÑÎã¨ Ïãú Í≤ΩÍ≥†\n\n3. Íµ¨ÌòÑ ÏòµÏÖò\n   - ÏûêÏ≤¥ rate limiter Ï∂îÍ∞Ä\n   - grammy ÌîåÎü¨Í∑∏Ïù∏ ÌôúÏö© (transformer-throttler)\n   - ÌÅêÏûâ ÏãúÏä§ÌÖú\n\n4. Í≤ΩÍ≥† Î∞©Ïãù\n   - Î°úÍ∑∏ Í≤ΩÍ≥†\n   - ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏïåÎ¶º\n   - ÏûêÎèô throttling\n\n## Ï∞∏Í≥†\n- grammY auto-retry plugin\n- Telegram Bot API docs","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T02:40:05.076533062+09:00","created_by":"Z","updated_at":"2026-02-02T02:40:05.076533062+09:00"}
{"id":"agi-e5r","title":"Create multi-provider usage utility module (src/usage.ts)","description":"Create a new module to fetch usage statistics from Claude Code, OpenAI Codex, and Gemini CLI.\n\n## Source Reference\nBased on https://github.com/zhugehyuk-contributions/claude-dashboard code patterns.\n\n## Implementation Details\n\n### Claude Code Usage (api-client.ts pattern)\n- API: GET https://api.anthropic.com/api/oauth/usage\n- Auth: Bearer token from ~/.claude/.credentials.json or macOS Keychain\n- Response: five_hour, seven_day, seven_day_sonnet (utilization %, reset time)\n\n### OpenAI Codex Usage (codex-client.ts pattern)\n- API: GET https://chatgpt.com/backend-api/wham/usage\n- Auth: Bearer token + account ID from ~/.codex/auth.json\n- Response: primary_window (5h), secondary_window (7d) with used_percent, reset times\n\n### Gemini Usage (gemini-client.ts pattern)\n- API: POST https://cloudcode-pa.googleapis.com/v1internal:retrieveUserQuota\n- Auth: OAuth token from macOS Keychain or ~/.gemini/oauth_creds.json\n- Response: buckets with remainingFraction, resetTime per model\n\n## Functions to implement\n- fetchClaudeUsage(): Promise\u003cClaudeUsage | null\u003e\n- fetchCodexUsage(): Promise\u003cCodexUsage | null\u003e\n- fetchGeminiUsage(): Promise\u003cGeminiUsage | null\u003e\n- fetchAllUsage(): Promise\u003cAllUsage\u003e (parallel fetch all)\n\n## Caching\n- In-memory cache with configurable TTL (default 60s)\n- Deduplicate concurrent requests","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:31:30.564745923+09:00","created_by":"Z","updated_at":"2026-02-02T01:33:29.393259141+09:00","closed_at":"2026-02-02T01:33:29.393259141+09:00","close_reason":"Closed","dependencies":[{"issue_id":"agi-e5r","depends_on_id":"agi-ix4","type":"blocks","created_at":"2026-02-02T01:31:59.776456518+09:00","created_by":"Z"}]}
{"id":"agi-ey6","title":"Add preflight service check before restart in make up","description":"Improve make up reliability with preflight checks before service restart\n\nCurrent: make up ‚Üí install ‚Üí build ‚Üí restart service\nProblem: If build fails, service is already stopped/restarted\n\nGoal: make up ‚Üí install ‚Üí build ‚Üí preflight check ‚Üí restart if OK\n\nImplementation:\n1. Add preflight target to Makefile\n2. Preflight checks:\n   - bun run typecheck passes\n   - No critical lint errors\n   - Service configuration valid\n3. Only restart service if all preflight checks pass\n4. Show clear error messages if preflight fails\n\nBenefits:\n- Prevents broken deployments\n- Service stays running if new code is broken\n- Clear feedback on what failed","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:41:27.927075357+09:00","created_by":"Z","updated_at":"2026-02-02T01:41:44.675602588+09:00"}
{"id":"agi-gi2","title":"Research: Claude Code context window usage \u0026 subscription weekly usage API","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:15:06.917549891+09:00","created_by":"Z","updated_at":"2026-02-02T01:19:17.485455809+09:00","closed_at":"2026-02-02T01:19:17.485455809+09:00","close_reason":"Closed"}
{"id":"agi-ix4","title":"Add usage types to src/types.ts","description":"Add TypeScript types for multi-provider usage data.\n\n## Types to add\n\n```typescript\n// Claude usage from oauth/usage endpoint\ninterface ClaudeUsage {\n  five_hour: { utilization: number; resets_at: string | null } | null;\n  seven_day: { utilization: number; resets_at: string | null } | null;\n  seven_day_sonnet: { utilization: number; resets_at: string | null } | null;\n}\n\n// Codex usage from ChatGPT backend\ninterface CodexUsage {\n  model: string;\n  planType: string;\n  primary: { usedPercent: number; resetAt: number } | null;\n  secondary: { usedPercent: number; resetAt: number } | null;\n}\n\n// Gemini usage from Code Assist API\ninterface GeminiUsage {\n  model: string;\n  usedPercent: number | null;\n  resetAt: string | null;\n}\n\n// Combined usage result\ninterface AllUsage {\n  claude: ClaudeUsage | null;\n  codex: CodexUsage | null;\n  gemini: GeminiUsage | null;\n  fetchedAt: number;\n}\n```","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:31:39.407631055+09:00","created_by":"Z","updated_at":"2026-02-02T01:32:33.226229237+09:00","closed_at":"2026-02-02T01:32:33.226229237+09:00","close_reason":"Closed"}
{"id":"agi-p62","title":"cron job queue system","description":"Implement cron job queue system to prevent jobs from being skipped when session is busy.\n\nCurrently: Cron jobs are skipped if session.isRunning\nGoal: Queue pending cron jobs and execute them when session becomes idle\n\nTasks:\n- [ ] Add pendingCronJobs queue to scheduler.ts (Array\u003c{schedule, timestamp}\u003e)\n- [ ] Modify executeScheduledPrompt: push to queue if session busy\n- [ ] Add processQueuedJobs() function to execute queued jobs\n- [ ] Hook into session completion to call processQueuedJobs()\n- [ ] Add queue status to /cron command output\n- [ ] Test: schedule job while session busy, verify it executes after","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T00:58:04.48459361+09:00","created_by":"Z","updated_at":"2026-02-02T01:09:23.480881355+09:00","closed_at":"2026-02-02T01:09:23.480881355+09:00","close_reason":"Closed"}
{"id":"agi-qzd","title":"Critical: Shell injection in save-and-restart.sh","description":"Security: Shell injection vulnerability in save-and-restart.sh\n\nLocation: save-and-restart.sh:16-25\n\nIssue: MESSAGE variable injected into heredoc without sanitization\nAttack: Message containing EOF or shell metacharacters can break out and execute arbitrary commands\n\nExample attack:\n./save-and-restart.sh 'EOF\n$(rm -rf ~)\ncat \u003c\u003cEOF'\n\nFix: Use quoted heredoc ('EOF') or printf instead of interpolation","status":"closed","priority":0,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:56:05.464760174+09:00","created_by":"Z","updated_at":"2026-02-02T02:10:26.354345237+09:00","closed_at":"2026-02-02T02:10:26.354345237+09:00","close_reason":"Closed"}
{"id":"agi-uey","title":"Fix make up to include service restart","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T00:15:12.002555983+09:00","created_by":"Z","updated_at":"2026-02-02T01:03:23.064613675+09:00","closed_at":"2026-02-02T00:20:06.929627814+09:00","close_reason":"Closed"}
{"id":"agi-vv1","title":"Real-time steering: inject user messages during Claude execution","description":"## Í∏∞Îä•\nÏÇ¨Ïö©ÏûêÍ∞Ä Claude Ïã§Ìñâ Ï§ëÏóê Î©îÏãúÏßÄÎ•º Î≥¥ÎÇ¥Î©¥ Ïã§ÏãúÍ∞ÑÏúºÎ°ú Ï†ÑÎã¨ÌïòÏó¨ ÌñâÎèôÏùÑ steering\n\n## Ï°∞ÏÇ¨ Í≤∞Í≥º\n\n### SDK ÏßÄÏõê\n- V1 API: `interrupt()` Î©îÏÑúÎìú + AsyncGenerator Ìå®ÌÑ¥\n- V2 API: `streamInput()` ÏûàÏúºÎÇò unstable\n- Hooks API: `PreToolUse` hookÏúºÎ°ú Ïª®ÌÖçÏä§Ìä∏ Ï£ºÏûÖ Í∞ÄÎä•\n\n### Í∂åÏû• ÏïÑÌÇ§ÌÖçÏ≤ò: Hook Injection + Interrupt\n```\nÏùºÎ∞ò Î©îÏãúÏßÄ (Ïã§Ìñâ Ï§ë) ‚Üí Î≤ÑÌçºÏóê Ï∂îÍ∞Ä ‚Üí Îã§Ïùå tool Ìò∏Ï∂ú Ï†Ñ Ï£ºÏûÖ\n! prefix ‚Üí Í∏∞Ï°¥Ï≤òÎüº abort + ÏÉà ÏøºÎ¶¨\n!! prefix ‚Üí hard interrupt (Ï¶âÏãú Ï§ëÎã®)\n```\n\n### Íµ¨ÌòÑ Î∞©Î≤ï\n1. SteeringBuffer ÌÅ¥ÎûòÏä§ ÏÉùÏÑ±\n2. PreToolUse hookÏóêÏÑú Î≤ÑÌçºÎêú Î©îÏãúÏßÄÎ•º additionalContextÎ°ú Ï£ºÏûÖ\n3. Í∏∞Ï°¥ ! interrupt Ïú†ÏßÄ\n\n### Ï∞∏Í≥†\n- GitHub Issue #70: Real-time steering (closed/completed)\n- GitHub Issue #120: V2 interrupt (open)\n- Tool use Ï§ë interrupt Ïãú ÏóêÎü¨ Í∞ÄÎä•ÏÑ± ÏûàÏùå (Issue #12162)","status":"open","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:10:15.867941209+09:00","created_by":"Z","updated_at":"2026-02-02T01:10:15.867941209+09:00"}
{"id":"agi-wdq","title":"message reaction indicators for turn tracking","description":"Add message reactions to indicate conversation turn status.\n\nProblem: User can't tell when Claude has received and is processing their message, or when Claude's turn is complete.\n\nSolution:\n1. When user message received ‚Üí Add reaction (üëÄ or ‚è≥) to user's message\n2. When Claude finishes turn ‚Üí Add reaction (‚úÖ) to Claude's last message\n\nImplementation:\n- Use Telegram setMessageReaction API\n- Add reaction to user message in message handlers\n- Add reaction to bot's last message when turn complete","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T00:59:57.144000709+09:00","created_by":"Z","updated_at":"2026-02-02T01:06:17.441973632+09:00","closed_at":"2026-02-02T01:06:17.441973632+09:00","close_reason":"Closed"}
{"id":"agi-xd7","title":"make up with context message for restart continuity","description":"Feature: Accept context message in make up command\n\nUsage:\nmake up \"current context and next tasks\"\n\nWorkflow:\n1. Before restart: Use oh-my-claude:save skill to save context\n2. Run make up to restart bot\n3. After restart: Auto-load saved context using oh-my-claude:load skill\n\nImplementation:\n- Modify Makefile to accept optional message parameter\n- Save message to docs/tasks/save/ before restart\n- On startup, check for saved context file\n- Notify user to use /load skill or auto-load\n\nGoal: Preserve conversation context across bot restarts","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:27:14.707652686+09:00","created_by":"Z","updated_at":"2026-02-02T01:36:53.259037784+09:00","closed_at":"2026-02-02T01:36:53.259037784+09:00","close_reason":"Closed"}
{"id":"agi-y86","title":"Progress spinner for work status","description":"ÏûëÏóÖ ÏßÑÌñâÏ§ë Î©îÏãúÏßÄ ÌïòÎã®Ïóê Ïä§ÌîºÎÑà ÌëúÏãú:\n1. ÌòÑÏû¨ ÏûëÏóÖ ÏßÑÌñâ ÏÉÅÌÉúÎ•º Îß® ÎßàÏßÄÎßâ Î©îÏãúÏßÄÎ°ú ÌëúÏãú\n2. ÏãúÍ∞Ñ ÌëúÏãú Ï¥àÎßàÎã§ ÏóÖÎç∞Ïù¥Ìä∏\n3. ÏûëÏóÖ ÏôÑÎ£åÏãú: ÏãúÏûëÏãúÍ∞Ñ, Ï¢ÖÎ£åÏãúÍ∞Ñ, ÏÜåÏöîÏãúÍ∞Ñ(Î∂Ñ:Ï¥à) ÌëúÏãú\n4. Íµ¨ÌòÑ ÌõÑ make upÏúºÎ°ú Ïû¨ÏãúÏûëÍπåÏßÄ ÏôÑÎ£å","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:04:17.150770594+09:00","created_by":"Z","updated_at":"2026-02-02T01:13:13.891376626+09:00","closed_at":"2026-02-02T01:13:13.891376626+09:00","close_reason":"Closed"}
{"id":"agi-zpw","title":"Fix: Progress timer race condition in streaming.ts","description":"Race condition: Timer may edit deleted progress message\n\nLocation: src/handlers/streaming.ts:158-177\n\nIssue: state.progressMessage can be mutated by recreateProgressMessage() while timer's async editMessageText is pending. Timer may hold stale reference.\n\nImpact: Intermittent 'message not found' errors from Telegram API\n\nFix: Capture message reference at start of timer callback and verify hasn't changed","status":"closed","priority":1,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:47:55.928136054+09:00","created_by":"Z","updated_at":"2026-02-02T01:52:35.232519955+09:00","closed_at":"2026-02-02T01:52:35.232519955+09:00","close_reason":"Closed"}
{"id":"agi-zvr","title":"Progress spinner not showing - race condition in createStatusCallback","description":"ÌòÑÏÉÅ: ÏßÄÌòÅÏù¥ Î¥á ÏÇ¨Ïö© Ï§ë ÏûëÏóÖ ÏãúÍ∞ÑÏù¥ ÌëúÏãúÎêòÏßÄ ÏïäÏùå\n\nÏû¨ÌòÑ:\n- Î¥áÏù¥ ÏûëÏóÖ ÏàòÌñâ Ï§ë\n- ÏßÑÌñâ ÏãúÍ∞Ñ/Í≤ΩÍ≥º ÏãúÍ∞ÑÏù¥ ÎÇòÏôÄÏïº ÌïòÎäîÎç∞ Ïïà ÎÇòÏò¥\n\nÏòàÏÉÅ ÏõêÏù∏:\n- Progress spinner/timer Î°úÏßÅ Î≤ÑÍ∑∏\n- src/handlers/streaming.tsÏùò progress tracking Ïù¥Ïäà\n- ÏµúÍ∑º agi-zpw, agi-5eb ÏàòÏ†ï ÌõÑ regression?\n\nÏ°∞ÏÇ¨ ÌïÑÏöî:\n1. Ïñ¥Îñ§ progress indicatorÍ∞Ä Ïïà ÎÇòÏò§ÎäîÏßÄ ÌôïÏù∏\n2. streaming.tsÏùò timer Î°úÏßÅ Ï≤¥ÌÅ¨\n3. ÏµúÍ∑º Ïª§Î∞ãÍ≥º Ïó∞Í¥ÄÏÑ± ÌôïÏù∏\n\nÎ≥¥Í≥†Ïûê: ÏßÄÌòÅ (2026-02-02 02:27)","notes":"## Root Cause (Systematic Debugging - Phase 1)\n\n**Race Condition in streaming.ts line 162-167:**\n\n```typescript\n// OLD CODE (BROKEN):\nrecreateProgressMessage().catch((error) =\u003e {  // fire-and-forget, NO AWAIT\n  console.debug(\"Failed to create initial progress message:\", error);\n});\n\n// Timer starts IMMEDIATELY, before message is created\nstate.progressTimer = setInterval(async () =\u003e {\n  const currentProgressMsg = state.progressMessage;\n  if (!currentProgressMsg) return;  // ‚Üê Always returns if msg not ready yet\n  ...\n```\n\n**3 Problems:**\n1. **Race condition**: Timer starts before `recreateProgressMessage()` completes\n2. **Silent failure**: If `ctx.reply()` fails, `progressMessage` stays null forever\n3. **No recovery**: Once failed, spinner never appears\n\n## Fix (Phase 4)\n\n**Changed `createStatusCallback()` to async and await message creation:**\n\n```typescript\n// NEW CODE (FIXED):\nexport async function createStatusCallback(...): Promise\u003cStatusCallback\u003e {\n  ...\n  // Wait for initial message to be created BEFORE starting timer\n  await recreateProgressMessage();\n  \n  // Now start timer (message is guaranteed to exist)\n  state.progressTimer = setInterval(...)\n}\n```\n\n**Updated all callers (6 files):**\n- text.ts (2 locations)\n- callback.ts\n- document.ts (2 locations)\n- photo.ts\n- voice.ts\n\n## Verification Needed\n\n**Test:** Send message and verify spinner appears with elapsed time\n**Expected:** `‚†ã Working... (0:01)` message shows and updates every second\n**Pass Criteria:** Spinner visible throughout bot processing\n\nTypecheck: ‚úì Passed\nManual test: ‚è≥ Pending","status":"open","priority":1,"issue_type":"bug","assignee":"Z","owner":"z@2lab.ai","created_at":"2026-02-02T02:27:52.529150619+09:00","created_by":"Z","updated_at":"2026-02-02T02:33:31.052033477+09:00"}
