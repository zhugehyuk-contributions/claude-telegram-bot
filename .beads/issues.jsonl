{"id":"agi-02p","title":"Unbounded queue growth in cron scheduler","description":"Security: pendingCronJobs queue grows without bound\n\nLocation: src/scheduler.ts:26, 104-106\n\nIssue: No max queue size limit. Jobs queue faster than execution\nImpact: Memory exhaustion if bot busy for extended period\n\nFix: Add max queue size (e.g., 100), reject or discard oldest when full","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:56:44.643292886+09:00","created_by":"Z","updated_at":"2026-02-02T02:10:26.363263772+09:00","closed_at":"2026-02-02T02:10:26.363263772+09:00","close_reason":"Closed"}
{"id":"agi-077","title":"Rename bd prefix to 9yr","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T00:21:19.656433209+09:00","created_by":"Z","updated_at":"2026-02-02T01:03:29.873565616+09:00","closed_at":"2026-02-02T01:03:29.873565616+09:00","close_reason":"Closed"}
{"id":"agi-0fg","title":"Rust port: wire MCP config into Claude CLI + per-chat TELEGRAM_CHAT_ID","description":"Scope:\n- Load MCP servers from mcp-config.json (JSON, env interpolation)\n- Pass to Claude CLI via --mcp-config for every run\n- Inject TELEGRAM_CHAT_ID per chat/run (so ask_user MCP can target the right chat)\nDeliverables:\n- ask_user works end-to-end in Rust bot with multi-chat safety\n- docs updated to reflect config file + binaries\n","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T12:40:14.129443186+09:00","created_by":"Z","updated_at":"2026-02-02T12:50:42.381055851+09:00","closed_at":"2026-02-02T12:50:42.381055851+09:00","close_reason":"Closed","dependencies":[{"issue_id":"agi-0fg","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T12:40:48.503002271+09:00","created_by":"Z"}]}
{"id":"agi-14p","title":"make up fails when service not installed - need fallback for dev mode","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T00:31:00.298338736+09:00","created_by":"Z","updated_at":"2026-02-02T01:03:23.063988473+09:00","closed_at":"2026-02-02T00:35:05.846589507+09:00","close_reason":"Closed"}
{"id":"agi-1a0","title":"cmd-int-1: Integration test for all new commands","description":"End-to-end integration test for command system.\n\n**Test Flow:**\n1. /help ‚Üí verify command list appears\n2. Type '/' ‚Üí verify autocomplete works\n3. /context ‚Üí verify token display\n4. Send messages ‚Üí verify threshold warnings\n5. /status ‚Üí verify emoji usage\n\n**Dependencies:** All other cmd-* tasks (needs complete implementation)\n\n**Acceptance:**\n- Test script in tests/integration/commands.test.ts\n- All commands work correctly\n- No regressions in existing functionality\n\n**Estimated effort:** 1h","status":"open","priority":1,"issue_type":"feature","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T17:25:20.111981262+09:00","created_by":"Z","updated_at":"2026-02-02T17:25:20.111981262+09:00","dependencies":[{"issue_id":"agi-1a0","depends_on_id":"agi-vjj","type":"blocks","created_at":"2026-02-02T17:26:08.767282038+09:00","created_by":"Z"},{"issue_id":"agi-1a0","depends_on_id":"agi-7di","type":"blocks","created_at":"2026-02-02T17:26:08.795746232+09:00","created_by":"Z"},{"issue_id":"agi-1a0","depends_on_id":"agi-1ti","type":"blocks","created_at":"2026-02-02T17:26:08.829113828+09:00","created_by":"Z"},{"issue_id":"agi-1a0","depends_on_id":"agi-jol","type":"blocks","created_at":"2026-02-02T17:26:08.861060208+09:00","created_by":"Z"},{"issue_id":"agi-1a0","depends_on_id":"agi-utp","type":"blocks","created_at":"2026-02-02T17:26:08.892111689+09:00","created_by":"Z"},{"issue_id":"agi-1a0","depends_on_id":"agi-771","type":"blocks","created_at":"2026-02-02T17:26:08.921009796+09:00","created_by":"Z"},{"issue_id":"agi-1a0","depends_on_id":"agi-a2b","type":"blocks","created_at":"2026-02-02T17:26:08.951176757+09:00","created_by":"Z"}]}
{"id":"agi-1ti","title":"cmd-ctx-3: Context tracking verification tests","description":"Create verification tests for context tracking accuracy.\n\n**Test Methodology:**\n- Known-size messages (e.g., 1000 chars ‚âà 250 tokens)\n- Send 10 messages, check /context output\n- Acceptable drift: ¬±5%\n- Document actual vs expected\n\n**Dependencies:** cmd-ctx-1, cmd-ctx-2 (needs implementation complete)\n\n**Acceptance:**\n- Test script in tests/context-verify.ts\n- Results logged to ARTIFACTS/context-test-YYYY-MM-DD.md\n- Drift within ¬±5% range\n\n**Estimated effort:** 1.5h","status":"open","priority":1,"issue_type":"feature","owner":"z@2lab.ai","estimated_minutes":90,"created_at":"2026-02-02T17:25:14.504212711+09:00","created_by":"Z","updated_at":"2026-02-02T17:25:14.504212711+09:00","dependencies":[{"issue_id":"agi-1ti","depends_on_id":"agi-vjj","type":"blocks","created_at":"2026-02-02T17:26:07.026590974+09:00","created_by":"Z"},{"issue_id":"agi-1ti","depends_on_id":"agi-7di","type":"blocks","created_at":"2026-02-02T17:26:07.052623754+09:00","created_by":"Z"}]}
{"id":"agi-30z","title":"Fix: handleRetry missing ctx.message undefined check","description":"Missing undefined check in handleRetry command\n\nLocation: src/handlers/commands.ts:467-506\n\nIssue: Creates fake context by spreading ctx.message which could be undefined in edge cases\n\nImpact: Potential crash when ctx.message is undefined\n\nFix: Add guard check before spreading ctx.message","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:48:14.256348813+09:00","created_by":"Z","updated_at":"2026-02-02T01:52:35.234822399+09:00","closed_at":"2026-02-02T01:52:35.234822399+09:00","close_reason":"Closed"}
{"id":"agi-4ja","title":"Rust port: sync main + port post-split TS features","description":"Goal: Bring rust-port branch up-to-date with main (resolve merge conflicts) and port key TS features added after the branch split into the Rust implementation for parity.\n\nScope (from main commits since merge-base 60213e3):\n- Outbound Telegram API throttling + 429 retry fallback\n- Startup auto-load from .last-save-id (oh-my-claude:load) + restart-context messaging\n- Context-limit warning should use cumulative context tokens (input+output)\n- Per-chat sequentialization semantics (commands/interrupt bypass)\n- (Optional) real-time steering parity investigation for CLI backend\n\nAcceptance:\n- rust-port merges cleanly with main\n- Rust bot behavior matches TS for the above items (where feasible)\n- cargo fmt/test/clippy pass; bun typecheck passes (for TS side)\n- Changes pushed to origin/rust-port and PR updated","status":"closed","priority":0,"issue_type":"epic","owner":"z@2lab.ai","estimated_minutes":360,"created_at":"2026-02-02T17:25:07.387055542+09:00","created_by":"Z","updated_at":"2026-02-02T18:12:21.827090944+09:00","closed_at":"2026-02-02T18:12:21.827090944+09:00","close_reason":"Completed rust-port sync + post-split feature parity: merged main, added Telegram API throttling+429 retry, startup auto-load (.last-save-id) + restart-context messaging, cumulative context-limit warning + auto-save, verified per-chat sequentialization/interrupt bypass, and documented steering limitation. All changes pushed to origin/rust-port and PR updated."}
{"id":"agi-4ja.1","title":"Merge main into rust-port and resolve conflicts","description":"Merge (or rebase if needed) main -\u003e rust-port to incorporate TS changes since merge-base, resolve any conflicts (.gitignore/Makefile/README/etc), and ensure branch is buildable.\n\nAcceptance:\n- rust-port contains all main commits up to HEAD\n- No merge conflicts remain; working tree clean\n- cargo fmt/test/clippy pass in rust/\n- bun run typecheck passes (TS)\n- push to origin/rust-port","status":"closed","priority":0,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T17:25:22.879221637+09:00","created_by":"Z","updated_at":"2026-02-02T17:29:31.601929896+09:00","closed_at":"2026-02-02T17:29:31.601929896+09:00","close_reason":"Closed","dependencies":[{"issue_id":"agi-4ja.1","depends_on_id":"agi-4ja","type":"parent-child","created_at":"2026-02-02T17:25:22.879850688+09:00","created_by":"Z"}]}
{"id":"agi-4ja.2","title":"Port outbound Telegram API throttling + 429 retry to Rust","description":"Port TS outbound Telegram API throttling (apiThrottler + 429 retry fallback) to Rust teloxide stack.\n\nApproach:\n- Add a MessagingPort decorator or TelegramMessenger wrapper that rate-limits send/edit/delete/reaction calls globally + per-chat.\n- Add 429 retry/backoff behavior where possible (parse retry_after if available).\n\nAcceptance:\n- Burst sends/edits no longer cause 429 in normal usage\n- On 429, operations are retried after server-provided delay\n- Unit tests for throttler timing/backpressure OR integration test behind feature flag\n- cargo fmt/test/clippy pass","status":"closed","priority":0,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":90,"created_at":"2026-02-02T17:25:41.041395963+09:00","created_by":"Z","updated_at":"2026-02-02T17:46:58.232690439+09:00","closed_at":"2026-02-02T17:46:58.232690439+09:00","close_reason":"Closed","dependencies":[{"issue_id":"agi-4ja.2","depends_on_id":"agi-4ja","type":"parent-child","created_at":"2026-02-02T17:25:41.042327411+09:00","created_by":"Z"}]}
{"id":"agi-4ja.3","title":"Port startup auto-load (.last-save-id) + restart-context messaging to Rust","description":"Port TS startup behavior (src/index.ts):\n- If /.last-save-id exists: validate save_id, run oh-my-claude:load, validate 'Loaded Context:' in response, mark restored cooldown, delete .last-save-id after success, notify user.\n- Else: scan docs/tasks/save/restart-context-*.md and include latest content in startup prompt.\n- Send a startup summary message (startup type: SIGTERM restart / resumed / fresh) to allowed user.\n\nAcceptance:\n- Rust bot auto-loads context after restart when .last-save-id present\n- Invalid save id is rejected and file removed\n- Startup message includes correct type label + optional saved context\n- cargo fmt/test/clippy pass","status":"closed","priority":0,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":90,"created_at":"2026-02-02T17:25:57.778244447+09:00","created_by":"Z","updated_at":"2026-02-02T17:58:33.130859345+09:00","closed_at":"2026-02-02T17:58:33.130859345+09:00","close_reason":"Implemented startup notification: .last-save-id auto-load with validation + restart-context detection. Added restored cooldown tracking + unit tests. Pushed commits df8dd1c and 5d26c6d.","dependencies":[{"issue_id":"agi-4ja.3","depends_on_id":"agi-4ja","type":"parent-child","created_at":"2026-02-02T17:25:57.779039705+09:00","created_by":"Z"}]}
{"id":"agi-4ja.4","title":"Port context-limit warning/token reporting parity to Rust","description":"Port TS cumulative context tracking semantics to Rust:\n- Track cumulative (input+output) context tokens across turns\n- Expose getter for current context tokens and trigger save threshold warning (e.g. 180k/200k) once per session with cooldown after /load\n- Ensure any user-facing 'Context Limit Approaching' messages use cumulative tokens (not per-turn)\n\nAcceptance:\n- Rust session stats show cumulative token usage\n- Save threshold triggers once and respects cooldown\n- Any warnings/reporting reflect cumulative tokens","status":"closed","priority":1,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T17:26:17.029100654+09:00","created_by":"Z","updated_at":"2026-02-02T18:05:56.078740972+09:00","closed_at":"2026-02-02T18:05:56.078740972+09:00","close_reason":"Implemented Rust context-limit monitoring using cumulative tokens, warning at 180k, and auto-save via oh-my-claude:save. Persists verified save id to .last-save-id and avoids repeated saves when file already exists. Added parsing tests. Pushed commit 6e59c32.","dependencies":[{"issue_id":"agi-4ja.4","depends_on_id":"agi-4ja","type":"parent-child","created_at":"2026-02-02T17:26:17.029799083+09:00","created_by":"Z"}]}
{"id":"agi-4ja.5","title":"Port per-chat sequentialization + interrupt bypass to Rust","description":"Port TS sequentialize() behavior to Rust teloxide:\n- Non-command messages are processed sequentially per chat to avoid race conditions\n- Commands and '! interrupt' bypass the queue so they execute immediately\n\nRust already has ChatLocks in ctb-telegram/router.rs but it's unused; wire it into message handling.\n\nAcceptance:\n- Two messages in same chat are processed sequentially\n- /commands and !messages bypass the lock\n- No deadlocks; concurrency safe","status":"closed","priority":1,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T17:26:33.089059165+09:00","created_by":"Z","updated_at":"2026-02-02T18:07:57.745936326+09:00","closed_at":"2026-02-02T18:07:57.745936326+09:00","close_reason":"Already implemented: per-chat lock acquisition in rust/crates/ctb-telegram/src/handlers/mod.rs (locks normal text/photo/doc/voice per chat; /commands + !interrupt bypass).","dependencies":[{"issue_id":"agi-4ja.5","depends_on_id":"agi-4ja","type":"parent-child","created_at":"2026-02-02T17:26:33.0899532+09:00","created_by":"Z"}]}
{"id":"agi-4ja.6","title":"Investigate real-time steering feasibility in Rust CLI backend","description":"TS supports real-time steering by buffering user messages and injecting them via Agent SDK PreToolUse hook. Rust port currently uses Claude CLI stream-json; may not support mid-run injection.\n\nWork:\n- Research claude CLI capabilities for mid-run steering or tool hooks\n- If feasible, implement equivalent; else implement best-effort behavior + document limitation\n\nAcceptance:\n- Clear decision + recommended implementation path\n- If implemented, steering messages sent during execution influence the run (or next safe boundary) without being lost","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T17:26:50.876954784+09:00","created_by":"Z","updated_at":"2026-02-02T18:11:47.269946942+09:00","closed_at":"2026-02-02T18:11:47.269946942+09:00","close_reason":"Investigated real-time steering: TS uses Agent SDK PreToolUse hooks to inject systemMessage mid-run; Rust backend uses claude CLI stream-json (one-way stdout) and cannot inject mid-run messages. Documented as known parity gap in docs/rust-port/parity-checklist.md and docs/rust-port/claude-cli-stream-json.md. Pushed commit a391e48.","dependencies":[{"issue_id":"agi-4ja.6","depends_on_id":"agi-4ja","type":"parent-child","created_at":"2026-02-02T17:26:50.877895182+09:00","created_by":"Z"}]}
{"id":"agi-5eb","title":"fix: spinner recreates itself on timer (infinite delete/create)","description":"Bug: Timer interval recreates spinner every second instead of editing\n\nCurrent broken logic:\n- Timer calls recreateProgressMessage() every 1s\n- recreateProgressMessage = DELETE + CREATE new message\n- Result: Spinner constantly deleted/recreated (flashing)\n\nCorrect logic should be:\n- Timer: EDIT existing message (update text only)\n- New output added: DELETE + CREATE (move to bottom)\n\nFix:\n1. Timer should use editMessageText (not delete/create)\n2. Only recreate when new messages are added\n3. Recreate = delete old + create new at bottom","status":"closed","priority":1,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:26:56.019383359+09:00","created_by":"Z","updated_at":"2026-02-02T01:28:35.979823832+09:00","closed_at":"2026-02-02T01:28:35.979823832+09:00","close_reason":"Closed"}
{"id":"agi-5kf","title":"Fix: recreateProgressMessage uncaught promise in initialization","description":"Uncaught promise during progress message initialization\n\nLocation: src/handlers/streaming.ts:154-155\n\nIssue: recreateProgressMessage() called without await, fire-and-forget. Errors may not propagate.\n\nImpact: Silent failures during initialization\n\nFix: Add await or explicit error handling, or document intentional fire-and-forget","status":"closed","priority":3,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:48:29.59035452+09:00","created_by":"Z","updated_at":"2026-02-02T01:52:35.236472574+09:00","closed_at":"2026-02-02T01:52:35.236472574+09:00","close_reason":"Closed"}
{"id":"agi-6dj","title":"Fix: send_html_split handles overlong single lines","description":"PR review: send_html_split only splits on newline boundaries. If a single line exceeds telegram_safe_limit, we may send oversized messages. Fix by chunking long lines or char-based fallback so every send \u003c= telegram_safe_limit.","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T15:22:31.169916816+09:00","created_by":"Z","updated_at":"2026-02-02T15:32:58.315127173+09:00","closed_at":"2026-02-02T15:32:58.315127173+09:00","close_reason":"Closed"}
{"id":"agi-6u4","title":"Critical: Progress timer needs per-conversation tracking","description":"Oracle found: Global progressInterval will clobber across multiple conversations\n\nIssue: StreamingState is per-message but progressInterval is global\nImpact: Multiple concurrent conversations will overwrite each other's timers\nRisk: Orphaned intervals, memory leaks, wrong chat getting updates\n\nFix: Use Map\u003cchatId, {interval, startTime}\u003e with 5-minute max timeout","status":"closed","priority":1,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:54:33.142349425+09:00","created_by":"Z","updated_at":"2026-02-02T02:10:40.327604327+09:00","closed_at":"2026-02-02T02:10:40.327604327+09:00","close_reason":"Closed"}
{"id":"agi-771","title":"cmd-emoji-1: Emoji constants and systematic usage","description":"Add emoji constants for message type distinction.\n\n**Constants (src/constants.ts):**\n- EMOJI_SYSTEM = '‚öôÔ∏è' (system responses)\n- EMOJI_MODEL = 'ü§ñ' (model responses, sparingly)\n- EMOJI_ERROR = '‚ùå' (errors)\n- EMOJI_SUCCESS = '‚úÖ' (success confirmations)\n- EMOJI_WARNING = '‚ö†Ô∏è' (warnings)\n\n**Apply to:**\n- System commands: /help, /context, /status ‚Üí ‚öôÔ∏è\n- Errors: error handlers ‚Üí ‚ùå\n- Success: /new, /compact ‚Üí ‚úÖ\n\n**Acceptance:**\n- Constants exported from src/constants.ts\n- All handlers use appropriate emojis\n- Consistent visual distinction\n\n**Estimated effort:** 1.5h","status":"open","priority":1,"issue_type":"feature","owner":"z@2lab.ai","estimated_minutes":90,"created_at":"2026-02-02T17:25:17.787884818+09:00","created_by":"Z","updated_at":"2026-02-02T17:25:17.787884818+09:00"}
{"id":"agi-7di","title":"cmd-ctx-2: Context threshold warnings","description":"Add proactive context warnings at 70%, 85%, 95% thresholds.\n\n**Requirements:**\n- Add 3 warning flags: warned70, warned85, warned95 in session.ts\n- Check thresholds in accumulateUsage() (140K, 170K, 190K)\n- Add getters: needsWarning70, needsWarning85, needsWarning95\n- Update handlers/text.ts to check flags after query (like needsSave pattern)\n- Display warnings with appropriate emojis\n\n**Current pattern (90% warning):**\n- session.ts: Sets contextLimitWarned at 180K\n- session.ts: Provides needsSave getter\n- handlers/text.ts line 115: Checks session.needsSave\n- handlers/text.ts line 118: Sends ctx.reply() with warning\n\n**Implementation:**\n1. session.ts: Add warned70/85/95 flags\n2. session.ts: Add needsWarning70/85/95 getters\n3. session.ts: Modify accumulateUsage() to check 140K, 170K, 190K\n4. handlers/text.ts: Add checks after line 114 (before needsSave)\n5. Clear flags on /new or /resume\n\n**Estimated effort:** 45min (simpler than 1h)","status":"in_progress","priority":0,"issue_type":"feature","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T17:25:13.233710425+09:00","created_by":"Z","updated_at":"2026-02-02T18:11:13.977764351+09:00","dependencies":[{"issue_id":"agi-7di","depends_on_id":"agi-vjj","type":"blocks","created_at":"2026-02-02T17:26:06.994416739+09:00","created_by":"Z"}]}
{"id":"agi-8uk","title":"Timer resource leak on error paths in streaming","description":"Security: progressTimer never cleared if error occurs before 'done'\n\nLocation: src/handlers/streaming.ts:159-183\n\nIssue: Timer started but only cleared when statusType==='done'. If error occurs before done, timer leaks\nImpact: Resource exhaustion over time with repeated failures\n\nFix: Add cleanup in error handlers, finally blocks, or max timeout","status":"closed","priority":1,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:56:26.057388317+09:00","created_by":"Z","updated_at":"2026-02-02T02:10:26.361441198+09:00","closed_at":"2026-02-02T02:10:26.361441198+09:00","close_reason":"Closed"}
{"id":"agi-a1s","title":"Integrate multi-provider usage into /stats command","description":"Update handleStats in src/handlers/commands.ts to display Claude, Codex, and Gemini usage.\n\n## Display Format\n\n```\nüìä Session Statistics\n\n... (existing session stats) ...\n\nüåê Provider Usage\n\nClaude Code:\n   5h: 45% (resets in 2h 15m)\n   7d: 12% (resets in 5d 3h)\n\nOpenAI Codex (plus):\n   5h: 30% (resets in 1h 45m)\n   7d: 8% (resets in 6d 12h)\n\nGemini (gemini-2.0-flash):\n   Usage: 25% (resets in 4h)\n```\n\n## Implementation\n1. Call fetchAllUsage() at start of handler\n2. Format each provider's usage with percentage and reset time\n3. Skip providers that return null (not installed/authenticated)\n4. Show loading indicator or cache status","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:31:48.508641909+09:00","created_by":"Z","updated_at":"2026-02-02T01:35:16.194224801+09:00","closed_at":"2026-02-02T01:35:16.194224801+09:00","close_reason":"Closed","dependencies":[{"issue_id":"agi-a1s","depends_on_id":"agi-e5r","type":"blocks","created_at":"2026-02-02T01:31:59.801718889+09:00","created_by":"Z"}]}
{"id":"agi-a2b","title":"cmd-emoji-2: Emoji rendering verification","description":"Verify emoji rendering across Telegram clients.\n\n**Test Matrix:**\n- Desktop (Windows, Mac, Linux)\n- Mobile (iOS, Android)\n- Web client\n\n**Dependencies:** cmd-emoji-1 (needs emoji implementation)\n\n**Acceptance:**\n- All emojis render correctly on tested platforms\n- Document any rendering issues in ARTIFACTS/emoji-test.md\n\n**Estimated effort:** 0.5h","status":"open","priority":2,"issue_type":"feature","owner":"z@2lab.ai","estimated_minutes":30,"created_at":"2026-02-02T17:25:19.050078615+09:00","created_by":"Z","updated_at":"2026-02-02T17:25:19.050078615+09:00","dependencies":[{"issue_id":"agi-a2b","depends_on_id":"agi-771","type":"blocks","created_at":"2026-02-02T17:26:07.105853403+09:00","created_by":"Z"}]}
{"id":"agi-bt9","title":"Fix PR#1 P0/P1 review issues (stderr/json/cancel + streaming/scheduler/mcp_config/audit)","description":"Resolve PR#1 review REQUEST_CHANGES: fix P0 issues in ctb-claude-cli (stderr capture, JSON parse errors surfaced, cancel/kill correctness) and P1 reliability issues (UTF-8 handling in mcp_config, streaming/scheduler send/edit error handling, ask-user file write errors, env::set_var removal, voice transcription error propagation, audit log robustness).","status":"closed","priority":0,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T15:37:40.635751649+09:00","created_by":"Z","updated_at":"2026-02-02T15:59:25.236962818+09:00","closed_at":"2026-02-02T15:59:25.236962818+09:00","close_reason":"Closed"}
{"id":"agi-c7f","title":"Bug: context-limit warning should use cumulative tokens","description":"In src/handlers/text.ts the context-limit warning/auto-save message uses session.lastUsage?.input_tokens to compute \"Current: ‚Ä¶ / 200,000\" and percentage, but session.needsSave is triggered from cumulative context (totalInputTokens + totalOutputTokens) in ClaudeSession.accumulateUsage(). This can show wildly incorrect percentages and logs contextTokens incorrectly.\\n\\nFix: Expose cumulative context token count from ClaudeSession (getter) and use it in the warning + telemetry.\\n\\nFiles:\\n- src/handlers/text.ts\\n- src/session.ts","status":"closed","priority":2,"issue_type":"bug","owner":"z@2lab.ai","created_at":"2026-02-02T16:25:38.900285608+09:00","created_by":"Z","updated_at":"2026-02-02T16:29:06.913948455+09:00","closed_at":"2026-02-02T16:29:06.913948455+09:00","close_reason":"Closed"}
{"id":"agi-cnf","title":"Port to Rust","description":"Plan and execute a full port of the TypeScript Telegram bot to Rust, including architecture, feature parity, and deployment.","status":"closed","priority":2,"issue_type":"epic","owner":"z@2lab.ai","created_at":"2026-02-02T01:52:10.21969328+09:00","created_by":"Z","updated_at":"2026-02-02T12:51:35.089964462+09:00","closed_at":"2026-02-02T12:51:35.089964462+09:00","close_reason":"Closed"}
{"id":"agi-cnf.10","title":"Rust port: formatting module","description":"Scope:\n- Markdown -\u003e Telegram HTML conversion.\n- Tool status formatting (emoji + truncation).\nDeliverables:\n- formatting.rs with tests covering edge cases.","notes":"Implementing Rust formatting module: Markdown-\u003eTelegram HTML + tool status formatting + tests\nImplemented Rust formatting module in rust/crates/ctb-core/src/formatting.rs: escape_html(), convert_markdown_to_html() (code blocks, inline code, headers/bold/italic, blockquotes, bullets, links, newline collapse), and format_tool_status() with emoji/truncation. Added unit tests.","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:01:37.131597449+09:00","created_by":"Z","updated_at":"2026-02-02T09:20:01.687868331+09:00","closed_at":"2026-02-02T09:20:01.687868331+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.10","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:01:37.132603841+09:00","created_by":"Z"},{"issue_id":"agi-cnf.10","depends_on_id":"agi-cnf.4","type":"blocks","created_at":"2026-02-02T02:16:36.600524772+09:00","created_by":"Z"}]}
{"id":"agi-cnf.11","title":"Rust port: streaming state module","description":"Scope:\n- Message segmentation + edit throttling.\n- Progress spinner timer + completion message.\n- Delete thinking/tool messages based on config; add reaction on completion.\nDeliverables:\n- streaming.rs state + status callback implementation.","notes":"Implementing streaming state module for Rust port (segmentation, throttled edits, progress timer, delete flags)\nImplemented streaming state module in rust/crates/ctb-core/src/streaming.rs: per-segment message tracking, throttled edits, progress spinner (tick), progress message recreation to bottom, final completion message, delete thinking/tool messages per config, completion reaction. Includes unit tests with fake messenger.","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:01:48.527392763+09:00","created_by":"Z","updated_at":"2026-02-02T09:25:36.910480656+09:00","closed_at":"2026-02-02T09:25:36.910480656+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.11","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:01:48.528201928+09:00","created_by":"Z"},{"issue_id":"agi-cnf.11","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:17:29.64569154+09:00","created_by":"Z"},{"issue_id":"agi-cnf.11","depends_on_id":"agi-cnf.10","type":"blocks","created_at":"2026-02-02T02:19:56.223730669+09:00","created_by":"Z"}]}
{"id":"agi-cnf.12","title":"Rust port: bot core + routing","description":"Scope:\\n- Teloxide bot init + dispatcher + error handler.\\n- Per-chat sequentialization for non-command messages.\\n- Startup/resume/restart notifications.\\n- Command registration wiring (logic in command handlers task).\\nDeliverables:\\n- main.rs + handlers::mod wired.","notes":"Review: sequentialize only non-command/non-! messages; callbacks bypass queue; startup resume + restart message update.\nWired teloxide bot core and routing: added real TelegramMessenger adapter implementing MessagingPort (send/edit/delete HTML, chat actions, inline keyboards; reactions best-effort no-op). Added ctb-telegram router with AppState + per-chat ChatLocks to sequentialize non-command/non-! messages; callbacks bypass queue. Startup parity: log bot info, auto-resume saved session, and if restart_file exists update the prior message (within 30s) then delete file. ctb binary now loads Config, wires ClaudeCliClient + ClaudeSession, and runs Telegram polling dispatcher. Stub handlers module created for commands/messages/callbacks to be filled in agi-cnf.13-17 and agi-cnf.22.","status":"closed","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:02:07.893717767+09:00","created_by":"Z","updated_at":"2026-02-02T11:14:40.686885235+09:00","closed_at":"2026-02-02T11:14:40.686885235+09:00","close_reason":"Closed","labels":["phase:3"],"dependencies":[{"issue_id":"agi-cnf.12","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:02:07.894575231+09:00","created_by":"Z"},{"issue_id":"agi-cnf.12","depends_on_id":"agi-cnf.9","type":"blocks","created_at":"2026-02-02T02:21:46.966678496+09:00","created_by":"Z"},{"issue_id":"agi-cnf.12","depends_on_id":"agi-cnf.27","type":"blocks","created_at":"2026-02-02T02:44:14.921161702+09:00","created_by":"Z"}]}
{"id":"agi-cnf.13","title":"Rust port: text handler","description":"Scope:\\n- Auth + rate limit + ! interrupt flow.\\n- Start typing indicator; stream response; retry on Claude crash (only).\\n- Error flow: abort/cancel =\u003e stop message; other errors =\u003e truncated error reply.\\n- Cleanup: stop typing + processing flag always.\\nDeliverables:\\n- handlers/text.rs parity with TS flow + error paths.","notes":"Review: rate limit before heavy work; retry only on claude crash; audit log original user text; interrupt flow clears stopRequested.\nImplemented Rust text handler (ctb-telegram/src/handlers/text.rs) with TS parity: ! interrupt flow (mark_interrupt + stop + 100ms sleep + clear_stop_requested), rate limit check before heavy work, store last_message for /retry, add_timestamp suffix, typing indicator loop, and streaming execution via ClaudeSession::send_message_to_chat (thinking/tool/text/done). Added retry-on-crash (detect exited with status/code) with session.kill() and a warning reply. Cancellation errors suppress Query stopped when interrupted (consume_interrupt_flag). Added audit logging for TEXT, rate-limit, and errors. Routing updated to bypass per-chat queue for ! messages and sequentialize normal text per chat.","status":"closed","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:02:19.13550156+09:00","created_by":"Z","updated_at":"2026-02-02T11:19:42.19262399+09:00","closed_at":"2026-02-02T11:19:42.19262399+09:00","close_reason":"Closed","labels":["phase:4"],"dependencies":[{"issue_id":"agi-cnf.13","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:02:19.136254843+09:00","created_by":"Z"},{"issue_id":"agi-cnf.13","depends_on_id":"agi-cnf.6","type":"blocks","created_at":"2026-02-02T02:18:11.3644377+09:00","created_by":"Z"},{"issue_id":"agi-cnf.13","depends_on_id":"agi-cnf.7","type":"blocks","created_at":"2026-02-02T02:19:03.191908619+09:00","created_by":"Z"},{"issue_id":"agi-cnf.13","depends_on_id":"agi-cnf.11","type":"blocks","created_at":"2026-02-02T02:20:43.755633841+09:00","created_by":"Z"},{"issue_id":"agi-cnf.13","depends_on_id":"agi-cnf.9","type":"blocks","created_at":"2026-02-02T02:21:58.324487514+09:00","created_by":"Z"},{"issue_id":"agi-cnf.13","depends_on_id":"agi-cnf.12","type":"blocks","created_at":"2026-02-02T02:23:18.269991663+09:00","created_by":"Z"}]}
{"id":"agi-cnf.14","title":"Rust port: voice handler","description":"Scope:\\n- Download voice file and transcribe via OpenAI.\\n- Error flow: no API key, download fail, transcription fail, abort/cancel.\\n- Cleanup: delete temp file on all exits; stop typing + processing flag.\\nDeliverables:\\n- handlers/voice.rs parity with TS + robust cleanup.","notes":"Review: check transcription availability; handle download errors; ensure temp file cleanup on all exits.","status":"closed","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:02:29.267172527+09:00","created_by":"Z","updated_at":"2026-02-02T12:22:51.674994567+09:00","closed_at":"2026-02-02T12:22:51.674994567+09:00","close_reason":"Closed","labels":["phase:4"],"dependencies":[{"issue_id":"agi-cnf.14","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:02:29.268059452+09:00","created_by":"Z"},{"issue_id":"agi-cnf.14","depends_on_id":"agi-cnf.6","type":"blocks","created_at":"2026-02-02T02:18:21.504506766+09:00","created_by":"Z"},{"issue_id":"agi-cnf.14","depends_on_id":"agi-cnf.7","type":"blocks","created_at":"2026-02-02T02:19:14.520353142+09:00","created_by":"Z"},{"issue_id":"agi-cnf.14","depends_on_id":"agi-cnf.11","type":"blocks","created_at":"2026-02-02T02:20:55.100128692+09:00","created_by":"Z"},{"issue_id":"agi-cnf.14","depends_on_id":"agi-cnf.9","type":"blocks","created_at":"2026-02-02T02:22:08.453579294+09:00","created_by":"Z"},{"issue_id":"agi-cnf.14","depends_on_id":"agi-cnf.12","type":"blocks","created_at":"2026-02-02T02:23:28.395013463+09:00","created_by":"Z"}]}
{"id":"agi-cnf.15","title":"Rust port: photo handler + media group buffer","description":"Scope:\\n- Download photos; buffer albums (1s).\\n- Error flow: download fail, rate limit, Claude errors; status message update/delete.\\n- Cleanup: delete temp photos + tool messages on error.\\nDeliverables:\\n- handlers/photo.rs + media_group.rs parity.","notes":"Review: album buffering uses 1s timeout; caption handling; delete status messages; remove temp photos.","status":"closed","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:02:39.425967205+09:00","created_by":"Z","updated_at":"2026-02-02T12:16:28.26645371+09:00","closed_at":"2026-02-02T12:16:28.26645371+09:00","close_reason":"Closed","labels":["phase:4"],"dependencies":[{"issue_id":"agi-cnf.15","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:02:39.427521764+09:00","created_by":"Z"},{"issue_id":"agi-cnf.15","depends_on_id":"agi-cnf.6","type":"blocks","created_at":"2026-02-02T02:18:31.632370905+09:00","created_by":"Z"},{"issue_id":"agi-cnf.15","depends_on_id":"agi-cnf.7","type":"blocks","created_at":"2026-02-02T02:19:24.654549596+09:00","created_by":"Z"},{"issue_id":"agi-cnf.15","depends_on_id":"agi-cnf.11","type":"blocks","created_at":"2026-02-02T02:21:05.228167483+09:00","created_by":"Z"},{"issue_id":"agi-cnf.15","depends_on_id":"agi-cnf.9","type":"blocks","created_at":"2026-02-02T02:22:36.553156973+09:00","created_by":"Z"},{"issue_id":"agi-cnf.15","depends_on_id":"agi-cnf.12","type":"blocks","created_at":"2026-02-02T02:23:39.713805432+09:00","created_by":"Z"}]}
{"id":"agi-cnf.16","title":"Rust port: document handler","description":"Scope:\\n- Download docs; detect PDF/text/archive; 10MB limit.\\n- Error flow: unsupported type, extract failure, Claude errors; status message update/delete.\\n- Integrate archive security helpers (see agi-cnf.26).\\nDeliverables:\\n- handlers/document.rs parity + safe extraction.","notes":"Review: enforce 10MB limit; secure archive extraction (no path traversal); cap total extracted content.","status":"closed","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:02:50.716534486+09:00","created_by":"Z","updated_at":"2026-02-02T12:20:21.254969528+09:00","closed_at":"2026-02-02T12:20:21.254969528+09:00","close_reason":"Closed","labels":["phase:4"],"dependencies":[{"issue_id":"agi-cnf.16","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:02:50.71742603+09:00","created_by":"Z"},{"issue_id":"agi-cnf.16","depends_on_id":"agi-cnf.6","type":"blocks","created_at":"2026-02-02T02:18:42.92633956+09:00","created_by":"Z"},{"issue_id":"agi-cnf.16","depends_on_id":"agi-cnf.7","type":"blocks","created_at":"2026-02-02T02:19:34.779775554+09:00","created_by":"Z"},{"issue_id":"agi-cnf.16","depends_on_id":"agi-cnf.11","type":"blocks","created_at":"2026-02-02T02:21:15.363587428+09:00","created_by":"Z"},{"issue_id":"agi-cnf.16","depends_on_id":"agi-cnf.9","type":"blocks","created_at":"2026-02-02T02:22:46.680982539+09:00","created_by":"Z"},{"issue_id":"agi-cnf.16","depends_on_id":"agi-cnf.12","type":"blocks","created_at":"2026-02-02T02:23:49.851277615+09:00","created_by":"Z"},{"issue_id":"agi-cnf.16","depends_on_id":"agi-cnf.26","type":"blocks","created_at":"2026-02-02T02:34:18.206842394+09:00","created_by":"Z"}]}
{"id":"agi-cnf.17","title":"Rust port: callback handler + ask_user integration","description":"Scope:\\n- Parse callback data; handle missing/expired request file.\\n- Error flow: invalid callback =\u003e answer + return; Claude errors =\u003e stop msg.\\n- Always answer callback; delete request file safely.\\nDeliverables:\\n- handlers/callback.rs parity with TS.","notes":"Review: validate callback data; handle missing/expired request file; always answer callback query; interrupt semantics before sending choice.\nImplemented teloxide callback handler for ask_user inline keyboards (ctb-telegram/src/handlers/callback.rs): validates auth, parses askuser:{request_id}:{idx}, loads /tmp/ask-user-{id}.json, validates option, edits the original keyboard message to show selection, answers callback query, deletes request file best-effort, interrupts any running Claude session (stop + 100ms + clear_stop_requested), then sends the selected option to Claude via session.send_message_to_chat with typing indicator and audit logging. Error paths: invalid/expired request answers callback and returns; Claude cancel shows Query stopped unless interrupted; other errors reply with truncated error. handle_callback is wired in handlers/mod.rs and router.","status":"closed","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:03:09.120630796+09:00","created_by":"Z","updated_at":"2026-02-02T11:22:46.935830784+09:00","closed_at":"2026-02-02T11:22:46.935830784+09:00","close_reason":"Closed","labels":["phase:4"],"dependencies":[{"issue_id":"agi-cnf.17","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:03:09.121448806+09:00","created_by":"Z"},{"issue_id":"agi-cnf.17","depends_on_id":"agi-cnf.6","type":"blocks","created_at":"2026-02-02T02:18:53.061150766+09:00","created_by":"Z"},{"issue_id":"agi-cnf.17","depends_on_id":"agi-cnf.7","type":"blocks","created_at":"2026-02-02T02:19:46.092580709+09:00","created_by":"Z"},{"issue_id":"agi-cnf.17","depends_on_id":"agi-cnf.11","type":"blocks","created_at":"2026-02-02T02:21:26.698104636+09:00","created_by":"Z"},{"issue_id":"agi-cnf.17","depends_on_id":"agi-cnf.9","type":"blocks","created_at":"2026-02-02T02:22:56.810500887+09:00","created_by":"Z"},{"issue_id":"agi-cnf.17","depends_on_id":"agi-cnf.12","type":"blocks","created_at":"2026-02-02T02:23:59.972659988+09:00","created_by":"Z"}]}
{"id":"agi-cnf.18","title":"Rust port: cron scheduler","description":"Scope:\n- Parse cron.yaml (yaml).\n- Schedule jobs; queue if session busy; rate limit.\n- Notify user with results.\nDeliverables:\n- scheduler.rs parity with TS.","notes":"Review: cron.yaml path validation; rate limit jobs/hour; queue when session busy; file watcher reload safety.","status":"closed","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:03:19.252307001+09:00","created_by":"Z","updated_at":"2026-02-02T11:56:59.730801736+09:00","closed_at":"2026-02-02T11:56:59.730801736+09:00","close_reason":"Closed","labels":["phase:3"],"dependencies":[{"issue_id":"agi-cnf.18","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:03:19.253230995+09:00","created_by":"Z"},{"issue_id":"agi-cnf.18","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:17:39.767650803+09:00","created_by":"Z"},{"issue_id":"agi-cnf.18","depends_on_id":"agi-cnf.9","type":"blocks","created_at":"2026-02-02T02:23:08.143657045+09:00","created_by":"Z"}]}
{"id":"agi-cnf.19","title":"Rust port: usage stats module","description":"Scope:\n- Fetch Claude/Codex/Gemini usage with caching.\n- Implement /stats formatting.\nDeliverables:\n- usage.rs parity with TS.","notes":"Review: timeouts for provider API calls; cache TTL behavior; mac keychain fallback to file; handle missing creds gracefully.","status":"closed","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:03:30.598056541+09:00","created_by":"Z","updated_at":"2026-02-02T12:03:14.783341198+09:00","closed_at":"2026-02-02T12:03:14.783341198+09:00","close_reason":"Closed","labels":["phase:3"],"dependencies":[{"issue_id":"agi-cnf.19","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:03:30.598917606+09:00","created_by":"Z"},{"issue_id":"agi-cnf.19","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:17:49.889884593+09:00","created_by":"Z"}]}
{"id":"agi-cnf.2","title":"Rust port: architecture + crate selection + module map","description":"Scope:\n- Map TS modules to Rust modules (config/security/session/handlers/scheduler/usage/etc).\n- Choose core crates and runtime (teloxide, tokio, reqwest, serde, tracing, etc).\n- Identify parity gaps and risks (Claude CLI vs SDK, MCP config, thinking tokens).\nDeliverables:\n- Module map + data flow notes.\n- Crate list with rationale.\n- Risk list with mitigation ideas.","notes":"Starting Rust port architecture/crate selection + module map\nDelivered architecture + crate selection + module map in docs/rust-port/architecture.md","status":"closed","priority":1,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:00:03.629676818+09:00","created_by":"Z","updated_at":"2026-02-02T03:01:05.648303271+09:00","closed_at":"2026-02-02T03:01:05.648303271+09:00","close_reason":"Closed","labels":["phase:0"],"dependencies":[{"issue_id":"agi-cnf.2","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:00:03.630707115+09:00","created_by":"Z"}]}
{"id":"agi-cnf.20","title":"Rust port: ask_user MCP server","description":"Scope:\n- Implement MCP ask_user server in Rust (stdio transport).\n- Write /tmp/ask-user-\u003cid\u003e.json with same schema.\nDeliverables:\n- ask_user_mcp binary with compatibility tests.","notes":"Review: ensure MCP protocol compatibility; request file schema matches TS; chat_id from env; unique request IDs.","status":"closed","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:03:40.739385325+09:00","created_by":"Z","updated_at":"2026-02-02T12:30:42.633132231+09:00","closed_at":"2026-02-02T12:30:42.633132231+09:00","close_reason":"Closed","labels":["phase:5"],"dependencies":[{"issue_id":"agi-cnf.20","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:03:40.74026614+09:00","created_by":"Z"},{"issue_id":"agi-cnf.20","depends_on_id":"agi-cnf.4","type":"blocks","created_at":"2026-02-02T02:16:46.77399389+09:00","created_by":"Z"}]}
{"id":"agi-cnf.21","title":"Rust port: docs + parity checklist","description":"Scope:\n- Update README/SECURITY/.env.example for Rust build/run.\n- Write manual parity checklist + smoke test plan.\nDeliverables:\n- Updated docs and checklist.","notes":"Review: include migration notes, service setup for Rust binary, parity checklist + manual smoke tests.","status":"closed","priority":4,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:03:50.868337107+09:00","created_by":"Z","updated_at":"2026-02-02T12:51:00.811490853+09:00","closed_at":"2026-02-02T12:51:00.811490853+09:00","close_reason":"Closed","labels":["phase:5"],"dependencies":[{"issue_id":"agi-cnf.21","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:03:50.869566794+09:00","created_by":"Z"},{"issue_id":"agi-cnf.21","depends_on_id":"agi-cnf.22","type":"blocks","created_at":"2026-02-02T02:25:06.857137426+09:00","created_by":"Z"},{"issue_id":"agi-cnf.21","depends_on_id":"agi-cnf.20","type":"blocks","created_at":"2026-02-02T02:25:18.222442853+09:00","created_by":"Z"},{"issue_id":"agi-cnf.21","depends_on_id":"agi-cnf.24","type":"blocks","created_at":"2026-02-02T02:28:58.03807873+09:00","created_by":"Z"},{"issue_id":"agi-cnf.21","depends_on_id":"agi-0fg","type":"blocks","created_at":"2026-02-02T12:41:38.253417738+09:00","created_by":"Z"}]}
{"id":"agi-cnf.22","title":"Rust port: command handlers","description":"Scope:\\n- Implement /start,/new,/stop,/status,/stats,/resume,/retry,/cron,/restart.\\n- Error flow: missing ctx.message for /retry; handle inactive session; guard against running query.\\n- Integrate usage/scheduler/session state formatting.\\nDeliverables:\\n- handlers/commands.rs parity with TS + error handling.","notes":"Review: /retry depends on text handler; /cron requires scheduler; /stats requires usage module; ensure HTML escaping + Telegram length limits in responses.","status":"closed","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:10:53.422944801+09:00","created_by":"Z","updated_at":"2026-02-02T12:09:13.692072349+09:00","closed_at":"2026-02-02T12:09:13.692072349+09:00","close_reason":"Closed","labels":["phase:3"],"dependencies":[{"issue_id":"agi-cnf.22","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:10:53.42359199+09:00","created_by":"Z"},{"issue_id":"agi-cnf.22","depends_on_id":"agi-cnf.12","type":"blocks","created_at":"2026-02-02T02:24:11.294217531+09:00","created_by":"Z"},{"issue_id":"agi-cnf.22","depends_on_id":"agi-cnf.13","type":"blocks","created_at":"2026-02-02T02:24:21.414478264+09:00","created_by":"Z"},{"issue_id":"agi-cnf.22","depends_on_id":"agi-cnf.18","type":"blocks","created_at":"2026-02-02T02:24:46.59457529+09:00","created_by":"Z"},{"issue_id":"agi-cnf.22","depends_on_id":"agi-cnf.19","type":"blocks","created_at":"2026-02-02T02:24:56.731957252+09:00","created_by":"Z"}]}
{"id":"agi-cnf.23","title":"Rust port: MCP config loader + migration","description":"Scope:\\n- Define Rust-readable MCP config format (json/toml/yaml).\\n- Implement loader + env interpolation for tokens.\\n- Write migration notes from mcp-config.ts to new format.\\nDeliverables:\\n- mcp_config.rs + example config file.","notes":"Implementing Rust-readable MCP config format + loader with env interpolation + migration notes\nImplemented MCP config loader in Rust core: rust/crates/ctb-core/src/mcp_config.rs (JSON schema matching Claude MCP, recursive  interpolation, tests). Added example file mcp-config.example.json and migration notes docs/rust-port/mcp-config-migration.md. Ignored mcp-config.json in .gitignore.","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:26:06.448850627+09:00","created_by":"Z","updated_at":"2026-02-02T09:38:14.829307882+09:00","closed_at":"2026-02-02T09:38:14.829307882+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.23","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:26:06.449738159+09:00","created_by":"Z"},{"issue_id":"agi-cnf.23","depends_on_id":"agi-cnf.4","type":"blocks","created_at":"2026-02-02T02:27:54.507096106+09:00","created_by":"Z"},{"issue_id":"agi-cnf.23","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:28:05.867080027+09:00","created_by":"Z"}]}
{"id":"agi-cnf.24","title":"Rust port: service/deploy scripts","description":"Scope:\\n- Add run scripts/Makefile targets for Rust binary.\\n- Update launchagent/systemd templates for Rust.\\n- Ensure PATH and env loading parity.\\nDeliverables:\\n- Updated Makefile + service templates.","notes":"Review: include PATH injection for pdftotext; service restart semantics; ensure log paths match Rust binary name.","status":"closed","priority":3,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:26:20.275325211+09:00","created_by":"Z","updated_at":"2026-02-02T12:35:16.019559195+09:00","closed_at":"2026-02-02T12:35:16.019559195+09:00","close_reason":"Closed","labels":["phase:5"],"dependencies":[{"issue_id":"agi-cnf.24","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:26:20.276326768+09:00","created_by":"Z"},{"issue_id":"agi-cnf.24","depends_on_id":"agi-cnf.12","type":"blocks","created_at":"2026-02-02T02:28:47.897763348+09:00","created_by":"Z"}]}
{"id":"agi-cnf.25","title":"Rust port: parser fixtures + tests","description":"Scope:\\n- Capture stream-json fixtures from claude CLI.\\n- Build parser unit tests for event sequencing (thinking/tool/text/usage/result).\\n- Add regression cases for large outputs and tool blocks.\\nDeliverables:\\n- fixtures/ + tests for session event parsing.","notes":"Review: fixtures should cover tool_use, thinking, partial chunks, errors; test parser handles interleaving + cancellation.\nAdded parser regression tests and fixtures for stream-json handling: new real fixture for invalid API key (claude-stream-json.invalid-api-key.jsonl) and a synthetic tool_use fixture (claude-stream-json.synthetic-tool-use.jsonl) to cover thinking/tool_use/text sequencing when live captures are not possible. Added ctb-core session pipeline unit tests verifying snapshot text dedupe, segment splitting on tool_use, Bash/file safety blocking (cancels model, emits BLOCKED), ask_user file scanning + inline keyboard + status update, and fixture playback from docs fixtures.","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:26:36.927014338+09:00","created_by":"Z","updated_at":"2026-02-02T11:00:52.900498283+09:00","closed_at":"2026-02-02T11:00:52.900498283+09:00","close_reason":"Closed","labels":["phase:2"],"dependencies":[{"issue_id":"agi-cnf.25","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:26:36.928074261+09:00","created_by":"Z"},{"issue_id":"agi-cnf.25","depends_on_id":"agi-cnf.3","type":"blocks","created_at":"2026-02-02T02:28:26.135236704+09:00","created_by":"Z"},{"issue_id":"agi-cnf.25","depends_on_id":"agi-cnf.9","type":"blocks","created_at":"2026-02-02T02:28:36.277874239+09:00","created_by":"Z"}]}
{"id":"agi-cnf.26","title":"Rust port: archive extraction security","description":"Scope:\\n- Defend against zip/tar path traversal (../, absolute paths).\\n- Enforce size limits per file and total extracted content.\\n- Ensure extraction dir is temp + cleaned, and only allowed extensions are read.\\nDeliverables:\\n- archive_security.rs helpers + tests.\\n- Guidance for document handler integration.","notes":"Implemented secure archive extraction helpers in ctb-core (rust/crates/ctb-core/src/archive_security.rs): safe_extract_archive() supports .zip, .tar, .tar.gz/.tgz with defenses against path traversal, absolute paths, Windows prefixes, and symlink/odd entry types; enforces max_files/max_file_bytes/max_total_bytes limits. Added unit tests covering zip/tar/tgz traversal and size limits, plus guidance doc docs/rust-port/archive-security.md. Added workspace deps flate2/tar/zip.","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:31:40.835460495+09:00","created_by":"Z","updated_at":"2026-02-02T11:06:35.294662207+09:00","closed_at":"2026-02-02T11:06:35.294662207+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.26","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:31:40.836506843+09:00","created_by":"Z"},{"issue_id":"agi-cnf.26","depends_on_id":"agi-cnf.4","type":"blocks","created_at":"2026-02-02T02:33:56.686671148+09:00","created_by":"Z"},{"issue_id":"agi-cnf.26","depends_on_id":"agi-cnf.6","type":"blocks","created_at":"2026-02-02T02:34:06.824093877+09:00","created_by":"Z"}]}
{"id":"agi-cnf.27","title":"Rust port: messenger abstraction layer","description":"Scope:\\n- Define cross-messenger message model (text/voice/photo/document/command/callback).\\n- Create MessagingPort trait (send/edit/reaction/typing/callback/inline buttons).\\n- Add capability map/feature flags for missing features.\\n- Build Telegram adapter skeleton wiring to port.\\nDeliverables:\\n- messaging/{mod,types,port}.rs + telegram adapter stubs.\\n- Migration notes for adding Slack/Discord/WhatsApp adapters.","notes":"Designing/implementing messenger abstraction (types+port+capabilities) and Telegram adapter skeleton\nImplemented messaging abstraction in Rust core: rust/crates/ctb-core/src/messaging/{mod,types,port}.rs with IncomingUpdate model + InlineKeyboard + MessagingCapabilities + async MessagingPort trait. Updated Telegram adapter stub to implement MessagingPort (rust/crates/ctb-telegram/src/lib.rs). Added migration notes: docs/rust-port/messaging.md.","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:41:46.997307772+09:00","created_by":"Z","updated_at":"2026-02-02T09:30:06.235413033+09:00","closed_at":"2026-02-02T09:30:06.235413033+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.27","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:41:46.998209299+09:00","created_by":"Z"},{"issue_id":"agi-cnf.27","depends_on_id":"agi-cnf.2","type":"blocks","created_at":"2026-02-02T02:43:01.57521216+09:00","created_by":"Z"},{"issue_id":"agi-cnf.27","depends_on_id":"agi-cnf.4","type":"blocks","created_at":"2026-02-02T02:43:23.022118664+09:00","created_by":"Z"},{"issue_id":"agi-cnf.27","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:43:43.29270336+09:00","created_by":"Z"}]}
{"id":"agi-cnf.28","title":"Rust port: model provider abstraction layer","description":"Scope:\\n- Define ModelClient trait with streaming events + capabilities.\\n- Add ModelConfig enum + provider selection (Claude CLI/OpenAI/Gemini/Local).\\n- Implement PromptAdapter for provider-specific system/thinking/tool formatting.\\n- Provide session identity abstraction for resume/restore differences.\\nDeliverables:\\n- model/{mod,types,client}.rs + capability matrix.\\n- Integration notes for swapping models.","notes":"Designing model provider abstraction: ModelClient streaming events, ModelConfig/provider selection, PromptAdapter, session identity\nImplemented model provider abstraction in Rust core: rust/crates/ctb-core/src/model/{mod,types,client}.rs with ProviderKind, SessionRef, ModelCapabilities, ModelConfig, RunRequest/Result, ModelEvent(raw JSON), async ModelClient trait, and ClaudeCliPromptAdapter for argv construction. Updated Claude CLI adapter stub to implement new ModelClient (rust/crates/ctb-claude-cli/src/lib.rs). Added capability/integration notes: docs/rust-port/model.md.","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:42:03.39199771+09:00","created_by":"Z","updated_at":"2026-02-02T09:34:00.415099071+09:00","closed_at":"2026-02-02T09:34:00.415099071+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.28","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:42:03.393052026+09:00","created_by":"Z"},{"issue_id":"agi-cnf.28","depends_on_id":"agi-cnf.2","type":"blocks","created_at":"2026-02-02T02:43:11.734829144+09:00","created_by":"Z"},{"issue_id":"agi-cnf.28","depends_on_id":"agi-cnf.4","type":"blocks","created_at":"2026-02-02T02:43:33.155226518+09:00","created_by":"Z"},{"issue_id":"agi-cnf.28","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:43:54.631826216+09:00","created_by":"Z"},{"issue_id":"agi-cnf.28","depends_on_id":"agi-cnf.3","type":"blocks","created_at":"2026-02-02T02:44:04.776141249+09:00","created_by":"Z"}]}
{"id":"agi-cnf.3","title":"Rust port: Claude CLI stream-json research + spec","description":"Scope:\n- Run claude CLI in stream-json mode; capture event shapes (assistant/tool/usage/result).\n- Verify flags for permission bypass, session resume, MCP config, input/output formats.\nDeliverables:\n- Stream JSON schema notes + sample fixture.\n- Required CLI flags documented.","notes":"Investigating claude CLI --stream-json event schema/flags for Rust port\nCaptured stream-json schema/flags notes in docs/rust-port/claude-cli-stream-json.md and fixture in docs/rust-port/fixtures/claude-stream-json.sample.jsonl (includes system:init, assistant, result). Also confirmed CLAUDE_CONFIG_DIR is required in sandbox/service contexts.","status":"closed","priority":1,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:00:13.770727624+09:00","created_by":"Z","updated_at":"2026-02-02T03:13:02.256821292+09:00","closed_at":"2026-02-02T03:13:02.256821292+09:00","close_reason":"Closed","labels":["phase:0"],"dependencies":[{"issue_id":"agi-cnf.3","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:00:13.771767559+09:00","created_by":"Z"}]}
{"id":"agi-cnf.4","title":"Rust port: workspace scaffolding + logging setup","description":"Scope:\n- Create Cargo workspace/crate layout for bot and optional MCP server.\n- Add tracing/logging and error handling patterns.\nDeliverables:\n- Cargo.toml with base deps.\n- src/ module skeletons compile.","notes":"Scaffolding Rust Cargo workspace + tracing/logging/error patterns\nImplemented Rust workspace scaffolding under rust/ with crates (ctb, ctb-core, ctb-telegram, ctb-claude-cli, ctb-openai). Added error/logging patterns (ctb-core::errors + logging). Workspace compiles (cargo check --workspace).","status":"closed","priority":1,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:00:23.907136574+09:00","created_by":"Z","updated_at":"2026-02-02T09:01:27.143929874+09:00","closed_at":"2026-02-02T09:01:27.143929874+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.4","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:00:23.908159968+09:00","created_by":"Z"},{"issue_id":"agi-cnf.4","depends_on_id":"agi-cnf.2","type":"blocks","created_at":"2026-02-02T02:16:05.051764295+09:00","created_by":"Z"}]}
{"id":"agi-cnf.5","title":"Rust port: config/env module","description":"Scope:\n- Parse .env and environment variables.\n- PATH injection and temp dir creation.\n- Build safety prompt, constants, allowed paths.\nDeliverables:\n- config.rs with typed settings + validation.\n- Parity with TS defaults.","notes":"Implementing typed config/env module for Rust port (parity with TS defaults)\nAdded typed config module in Rust core: rust/crates/ctb-core/src/config.rs (env + optional .env, PATH injection, temp dir creation, safety prompt, limits/flags, parity with TS defaults).","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:00:34.053267124+09:00","created_by":"Z","updated_at":"2026-02-02T09:05:40.868417339+09:00","closed_at":"2026-02-02T09:05:40.868417339+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.5","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:00:34.055402529+09:00","created_by":"Z"},{"issue_id":"agi-cnf.5","depends_on_id":"agi-cnf.4","type":"blocks","created_at":"2026-02-02T02:16:26.477472547+09:00","created_by":"Z"}]}
{"id":"agi-cnf.6","title":"Rust port: security module","description":"Scope:\n- Token-bucket rate limiter.\n- Path validation with symlink resolution + temp path allowlist.\n- Command safety checks for rm + blocked patterns.\nDeliverables:\n- security.rs with tests for edge cases.","notes":"Implementing Rust security module: token bucket, path validation, command safety + tests\nImplemented Rust security module in rust/crates/ctb-core/src/security.rs: auth allowlist, token-bucket rate limiter, path validation (canonicalize+.. normalization, temp allowlist, ~ expansion incl allowed list), rm command safety + blocked patterns. Added unit tests for symlink escape, traversal, rm parsing, tilde, rate limiter.","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:00:45.349835582+09:00","created_by":"Z","updated_at":"2026-02-02T09:09:45.390236419+09:00","closed_at":"2026-02-02T09:09:45.390236419+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.6","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:00:45.350719751+09:00","created_by":"Z"},{"issue_id":"agi-cnf.6","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:16:58.07589677+09:00","created_by":"Z"}]}
{"id":"agi-cnf.7","title":"Rust port: utilities + audit logging","description":"Scope:\n- Audit log writer (JSON/plain text) with truncation rules.\n- Timestamp helper, typing indicator loop, interrupt helper.\nDeliverables:\n- utils.rs with audit functions.\n- Unit tests for formatting/truncation.","notes":"Implementing Rust utilities + audit logging with truncation rules and tests\nAdded Rust utilities + audit logging in rust/crates/ctb-core/src/utils.rs: RFC3339 timestamp helper, add_timestamp(), interrupt prefix helper, cancellable interval loop, AuditLogger (json/plain) with 500-char truncation + recursive JSON truncation, and unit tests.","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:01:05.661945893+09:00","created_by":"Z","updated_at":"2026-02-02T09:14:27.598505039+09:00","closed_at":"2026-02-02T09:14:27.598505039+09:00","close_reason":"Closed","labels":["phase:1"],"dependencies":[{"issue_id":"agi-cnf.7","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:01:05.662779381+09:00","created_by":"Z"},{"issue_id":"agi-cnf.7","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:17:08.205231978+09:00","created_by":"Z"}]}
{"id":"agi-cnf.8","title":"Rust port: session runner A (CLI spawn/resume/cancel)","description":"Scope:\n- Spawn claude CLI with stream-json output.\n- Implement session persistence file + resume logic.\n- Cancellation token for /stop and ! interrupt.\nDeliverables:\n- session.rs core runner that can stream events.\n- Resume/kill flows parity with TS.","notes":"Implementing Rust session runner A: spawn claude CLI stream-json, session persistence/resume, cancellation (stop/interrupt)\nImplemented Claude CLI runner + session persistence/cancel: ctb-claude-cli spawns claude in print+stream-json mode, streams NDJSON events to callback, extracts session/result/usage, and supports cancel() (kills child). Added provider-agnostic session manager in ctb-core (rust/crates/ctb-core/src/session.rs) that persists session file, supports resume_last(), stop() and interrupt flag flow, and injects date/time + thinking token selection parity.","status":"closed","priority":2,"issue_type":"task","assignee":"Z","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:01:16.866314512+09:00","created_by":"Z","updated_at":"2026-02-02T09:52:44.944895409+09:00","closed_at":"2026-02-02T09:52:44.944895409+09:00","close_reason":"Closed","labels":["phase:2"],"dependencies":[{"issue_id":"agi-cnf.8","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:01:16.867055102+09:00","created_by":"Z"},{"issue_id":"agi-cnf.8","depends_on_id":"agi-cnf.3","type":"blocks","created_at":"2026-02-02T02:16:15.188163377+09:00","created_by":"Z"},{"issue_id":"agi-cnf.8","depends_on_id":"agi-cnf.5","type":"blocks","created_at":"2026-02-02T02:17:18.334408476+09:00","created_by":"Z"},{"issue_id":"agi-cnf.8","depends_on_id":"agi-cnf.23","type":"blocks","created_at":"2026-02-02T02:28:15.999586844+09:00","created_by":"Z"},{"issue_id":"agi-cnf.8","depends_on_id":"agi-cnf.28","type":"blocks","created_at":"2026-02-02T02:44:26.188941757+09:00","created_by":"Z"}]}
{"id":"agi-cnf.9","title":"Rust port: session runner B (event handling/usage)","description":"Scope:\n- Parse stream events into thinking/tool/text segments.\n- Tool safety checks (Bash + file ops).\n- Usage accumulation + ask_user trigger hooks.\nDeliverables:\n- Event pipeline wired to status callback.\n- Token usage counters parity.","notes":"Review: parse partial events; ensure ask_user tool triggers button flow; clear stopRequested after interrupts; flush queued cron jobs after completion.\nImplemented session runner B in Rust core: added ClaudeSession::send_message_to_chat(chat_id, prompt, messenger) which runs the model while a background EventPipeline parses stream-json ModelEvent into thinking/tool/text/segment_end/done updates via StreamingState, with a 1s progress spinner tick. Enforced safety checks for Bash commands and Read/Write/Edit file paths using ctb-core security, and emit user-visible BLOCKED / Access denied tool messages before cancelling. Added cumulative token usage accumulation (parity with TS) and an ask_user hook: when mcp__ask-user tool is used, scan /tmp/ask-user-*.json, send inline keyboard, mark file as sent, then cancel the run and return Waiting for user selection.","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T02:01:26.994956107+09:00","created_by":"Z","updated_at":"2026-02-02T10:26:31.782759446+09:00","closed_at":"2026-02-02T10:26:31.782759446+09:00","close_reason":"Closed","labels":["phase:2"],"dependencies":[{"issue_id":"agi-cnf.9","depends_on_id":"agi-cnf","type":"parent-child","created_at":"2026-02-02T02:01:26.995848987+09:00","created_by":"Z"},{"issue_id":"agi-cnf.9","depends_on_id":"agi-cnf.6","type":"blocks","created_at":"2026-02-02T02:18:01.221031865+09:00","created_by":"Z"},{"issue_id":"agi-cnf.9","depends_on_id":"agi-cnf.10","type":"blocks","created_at":"2026-02-02T02:20:23.482590239+09:00","created_by":"Z"},{"issue_id":"agi-cnf.9","depends_on_id":"agi-cnf.11","type":"blocks","created_at":"2026-02-02T02:20:33.617695742+09:00","created_by":"Z"},{"issue_id":"agi-cnf.9","depends_on_id":"agi-cnf.8","type":"blocks","created_at":"2026-02-02T02:21:36.831570292+09:00","created_by":"Z"},{"issue_id":"agi-cnf.9","depends_on_id":"agi-cnf.28","type":"blocks","created_at":"2026-02-02T02:44:36.323481839+09:00","created_by":"Z"}]}
{"id":"agi-d2n","title":"Bug: '! interrupt' swallowed by steering buffer (text handler)","description":"Regression: In src/handlers/text.ts, steering buffering runs immediately after checkInterrupt(). If user sends an interrupt message starting with '!' while a query is still running, checkInterrupt() aborts the current run but session.isProcessing often remains true, so the stripped interrupt message is buffered as steering and handleText returns early. The previous request‚Äôs stopProcessing() cleanup then clears the unconsumed steering buffer, so the interrupt instruction never executes.\\n\\nFix: Detect interrupt before stripping (or have checkInterrupt return a flag) and skip steering-buffer path for interrupt messages; optionally wait briefly for processing cleanup after interrupt.\\n\\nFiles:\\n- src/handlers/text.ts","status":"closed","priority":1,"issue_type":"bug","owner":"z@2lab.ai","created_at":"2026-02-02T16:25:05.470206618+09:00","created_by":"Z","updated_at":"2026-02-02T16:29:06.906184087+09:00","closed_at":"2026-02-02T16:29:06.906184087+09:00","close_reason":"Closed"}
{"id":"agi-do5","title":"Research: Telegram rate limit ÏÇ¨Ï†Ñ Í∞êÏßÄ/Í≤ΩÍ≥† ÏãúÏä§ÌÖú","description":"Telegram API rate limit (429) ÏÇ¨Ï†Ñ Í∞êÏßÄ/Í≤ΩÍ≥† ÏãúÏä§ÌÖú Íµ¨ÌòÑ\n\nÎ∞∞Í≤Ω:\n- ÌòÑÏû¨ 429 ÏóêÎü¨ Î∞úÏÉù ÌõÑÏóêÏïº Ïù∏ÏßÄ (retry_after 880Ï¥à = 14Î∂Ñ ÎåÄÍ∏∞)\n- Í∏∞Ï°¥ RateLimiterÎäî ÏÇ¨Ïö©Ïûê ÏöîÏ≤≠Ïö© (Î¥á‚ÜíÏÇ¨Ïö©Ïûê)\n- Telegram API (Î¥á‚ÜíTelegram) rate limitÏùÄ Î≥ÑÎèÑ Ï≤òÎ¶¨ ÌïÑÏöî\n\nÏ°∞ÏÇ¨ Ìï≠Î™©:\n1. Telegram Bot API rate limit Ï†ïÏ±Ö\n   - Î©îÏãúÏßÄ/Î∂Ñ Ï†úÌïú (Í≥µÏãù Î¨∏ÏÑú)\n   - sendMessage vs editMessage Ï∞®Ïù¥\n   - Ï±ÑÌåÖÎ≥Ñ/Î¥áÎ≥Ñ Ï†úÌïú\n\n2. Grammy transformer-throttler ÌîåÎü¨Í∑∏Ïù∏\n   - ÏÑ§Ïπò: @grammyjs/transformer-throttler\n   - ÏÑ§Ï†ï: out/inThrottler\n   - ÏûÑÍ≥ÑÍ∞í ÎèÑÎã¨ Ïãú ÏûêÎèô ÌÅêÏûâ\n\n3. Íµ¨ÌòÑ Î∞©Ïïà\n   - Bot setupÏóê throttler Ï∂îÍ∞Ä\n   - ÏûÑÍ≥ÑÍ∞í Í≤ΩÍ≥† Î°úÍπÖ\n   - ÏÇ¨Ïö©Ïûê ÏïåÎ¶º (ÏÑ†ÌÉù)\n\nÎÇ®ÏùÄ ÏûëÏóÖ:\n- Telegram API rate limit Í≥µÏãù Î¨∏ÏÑú Ï°∞ÏÇ¨\n- Grammy throttler ÌîåÎü¨Í∑∏Ïù∏ ÏÑ§Ïπò Î∞è ÏÑ§Ï†ï\n- ÌÖåÏä§Ìä∏ Î∞è Í≤ÄÏ¶ù","notes":"## Î∞∞Í≤Ω\n- Telegram API 429 ÏóêÎü¨Í∞Ä Î∞úÏÉùÌïú ÌõÑÏóêÏïº rate limit Ïù∏ÏßÄ\n- retry_after: 880Ï¥à (14Î∂Ñ) ÎåÄÍ∏∞ ÌïÑÏöî\n- ÏÇ¨Ïö©Ïûê Í≤ΩÌóò Ï†ÄÌïò\n\n## Î¶¨ÏÑúÏπò Ìï≠Î™©\n1. Telegram API rate limit Ï†ïÏ±Ö Ï°∞ÏÇ¨\n   - Î©îÏãúÏßÄ/Î∂Ñ Ï†úÌïú\n   - editMessage vs sendMessage Ï∞®Ïù¥\n   - Ï±ÑÌåÖÎ≥Ñ vs Î¥áÎ≥Ñ Ï†úÌïú\n\n2. ÏÇ¨Ï†Ñ Í∞êÏßÄ Î∞©Î≤ï\n   - Î©îÏãúÏßÄ Ïπ¥Ïö¥ÌÑ∞ Íµ¨ÌòÑ\n   - Ïä¨ÎùºÏù¥Îî© ÏúàÎèÑÏö∞ Î∞©Ïãù\n   - ÏûÑÍ≥ÑÍ∞í ÎèÑÎã¨ Ïãú Í≤ΩÍ≥†\n\n3. Íµ¨ÌòÑ ÏòµÏÖò\n   - ÏûêÏ≤¥ rate limiter Ï∂îÍ∞Ä\n   - grammy ÌîåÎü¨Í∑∏Ïù∏ ÌôúÏö© (transformer-throttler)\n   - ÌÅêÏûâ ÏãúÏä§ÌÖú\n\n4. Í≤ΩÍ≥† Î∞©Ïãù\n   - Î°úÍ∑∏ Í≤ΩÍ≥†\n   - ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏïåÎ¶º\n   - ÏûêÎèô throttling\n\n## Ï∞∏Í≥†\n- grammY auto-retry plugin\n- Telegram Bot API docs\n\n---\nVERIFICATION @ 2026-02-02T07:25:25Z\nStatus: verified\nCommand: cd ~/2lab.ai/claude-telegram-bot.p9 \u0026\u0026 bun run typecheck \u0026\u0026 bun run lint:check\nExit Code: 0\n\nOutput:\n```\n$ bun run --bun tsc --noEmit\n$ eslint src --ext .ts\n\n/home/zhugehyuk/2lab.ai/claude-telegram-bot.p9/src/session.ts\n  261:22  warning  'input' is defined but never used. Allowed unused args must match /^_/u  @typescript-eslint/no-unused-vars\n\n/home/zhugehyuk/2lab.ai/claude-telegram-bot.p9/src/usage.ts\n   99:47  warning  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any\n  192:47  warning  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any\n  307:45  warning  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any\n  378:45  warning  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any\n  419:47  warning  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any\n  426:46  warning  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any\n\n‚úñ 7 problems (0 errors, 7 warnings)\n```\n","status":"closed","priority":1,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T02:40:05.076533062+09:00","created_by":"Z","updated_at":"2026-02-02T16:25:34.077206746+09:00","closed_at":"2026-02-02T16:25:34.077206746+09:00","close_reason":"Telegram API rate limit prevention Íµ¨ÌòÑ ÏôÑÎ£å (commit 2ce5b6d). Grammy throttlerÎ°ú global/group/private Ï†úÌïú Ï†ÅÏö©, 429 fallback handler Ï∂îÍ∞Ä, Oracle Î¶¨Î∑∞ ÏôÑÎ£å."}
{"id":"agi-e5r","title":"Create multi-provider usage utility module (src/usage.ts)","description":"Create a new module to fetch usage statistics from Claude Code, OpenAI Codex, and Gemini CLI.\n\n## Source Reference\nBased on https://github.com/zhugehyuk-contributions/claude-dashboard code patterns.\n\n## Implementation Details\n\n### Claude Code Usage (api-client.ts pattern)\n- API: GET https://api.anthropic.com/api/oauth/usage\n- Auth: Bearer token from ~/.claude/.credentials.json or macOS Keychain\n- Response: five_hour, seven_day, seven_day_sonnet (utilization %, reset time)\n\n### OpenAI Codex Usage (codex-client.ts pattern)\n- API: GET https://chatgpt.com/backend-api/wham/usage\n- Auth: Bearer token + account ID from ~/.codex/auth.json\n- Response: primary_window (5h), secondary_window (7d) with used_percent, reset times\n\n### Gemini Usage (gemini-client.ts pattern)\n- API: POST https://cloudcode-pa.googleapis.com/v1internal:retrieveUserQuota\n- Auth: OAuth token from macOS Keychain or ~/.gemini/oauth_creds.json\n- Response: buckets with remainingFraction, resetTime per model\n\n## Functions to implement\n- fetchClaudeUsage(): Promise\u003cClaudeUsage | null\u003e\n- fetchCodexUsage(): Promise\u003cCodexUsage | null\u003e\n- fetchGeminiUsage(): Promise\u003cGeminiUsage | null\u003e\n- fetchAllUsage(): Promise\u003cAllUsage\u003e (parallel fetch all)\n\n## Caching\n- In-memory cache with configurable TTL (default 60s)\n- Deduplicate concurrent requests","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:31:30.564745923+09:00","created_by":"Z","updated_at":"2026-02-02T01:33:29.393259141+09:00","closed_at":"2026-02-02T01:33:29.393259141+09:00","close_reason":"Closed","dependencies":[{"issue_id":"agi-e5r","depends_on_id":"agi-ix4","type":"blocks","created_at":"2026-02-02T01:31:59.776456518+09:00","created_by":"Z"}]}
{"id":"agi-ey6","title":"Add preflight service check before restart in make up","description":"Improve make up reliability with preflight checks before service restart\n\nCurrent: make up ‚Üí install ‚Üí build ‚Üí restart service\nProblem: If build fails, service is already stopped/restarted\n\nGoal: make up ‚Üí install ‚Üí build ‚Üí preflight check ‚Üí restart if OK\n\nImplementation:\n1. Add preflight target to Makefile\n2. Preflight checks:\n   - bun run typecheck passes\n   - No critical lint errors\n   - Service configuration valid\n3. Only restart service if all preflight checks pass\n4. Show clear error messages if preflight fails\n\nBenefits:\n- Prevents broken deployments\n- Service stays running if new code is broken\n- Clear feedback on what failed","notes":"## Implementation Complete (2026-02-02)\n\n**Oracle Architecture:** Single preflight target with exit on failure\n\n**Changes:**\n\n1. **package.json:**\n   - Added lint:check script (eslint src --ext .ts)\n\n2. **Makefile:**\n   - Added preflight target:\n     - typecheck (blocks on failure)\n     - lint:check (blocks on errors, allows warnings)\n   - Modified up: install ‚Üí build ‚Üí preflight ‚Üí restart\n   - Added up-force: emergency bypass (skips preflight)\n\n**How It Works:**\n```\nmake up ‚Üí preflight runs BEFORE service restart\n‚Üí If preflight fails: old service keeps running (safe)\n‚Üí If preflight passes: service restarts with new code\n```\n\n**Test Evidence:**\n- make preflight with 0 errors, 6 warnings ‚Üí ‚úÖ PASS\n- Errors would block deployment\n\n**Verification Command:**\n`make preflight \u0026\u0026 echo 'OK'`\n\n---\nVERIFICATION @ 2026-02-02T06:24:22Z\nStatus: verified\nCommand: make preflight \u0026\u0026 echo 'OK'\nExit Code: 0\n\nOutput:\n```\nüîç Running preflight checks...\n$ bun run --bun tsc --noEmit\n$ eslint src --ext .ts\n\n/home/zhugehyuk/2lab.ai/claude-telegram-bot.p9/src/usage.ts\n   99:47  warning  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any\n  192:47  warning  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any\n  307:45  warning  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any\n  378:45  warning  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any\n  419:47  warning  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any\n  426:46  warning  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any\n\n‚úñ 6 problems (0 errors, 6 warnings)\n\n‚úÖ Preflight passed\nOK\n```\n","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:41:27.927075357+09:00","created_by":"Z","updated_at":"2026-02-02T15:24:29.418861106+09:00","closed_at":"2026-02-02T15:24:29.418861106+09:00","close_reason":"Preflight check system implemented and tested"}
{"id":"agi-gi2","title":"Research: Claude Code context window usage \u0026 subscription weekly usage API","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:15:06.917549891+09:00","created_by":"Z","updated_at":"2026-02-02T01:19:17.485455809+09:00","closed_at":"2026-02-02T01:19:17.485455809+09:00","close_reason":"Closed"}
{"id":"agi-guz","title":"cmd-doc-1: Update documentation","description":"Document new command system features.\n\n**Update Files:**\n- README.md: Add /context, /help to command list\n- CLAUDE.md: Add context threshold behavior\n- ARTIFACTS/: Create command-system.md architecture doc\n\n**Dependencies:** cmd-int-1 (needs verified implementation)\n\n**Acceptance:**\n- Documentation matches implementation\n- Examples included for key features\n- Architecture decisions documented\n\n**Estimated effort:** 0.5h","status":"open","priority":2,"issue_type":"feature","owner":"z@2lab.ai","estimated_minutes":30,"created_at":"2026-02-02T17:25:21.101249351+09:00","created_by":"Z","updated_at":"2026-02-02T17:25:21.101249351+09:00","dependencies":[{"issue_id":"agi-guz","depends_on_id":"agi-1a0","type":"blocks","created_at":"2026-02-02T17:26:10.29305788+09:00","created_by":"Z"}]}
{"id":"agi-ix4","title":"Add usage types to src/types.ts","description":"Add TypeScript types for multi-provider usage data.\n\n## Types to add\n\n```typescript\n// Claude usage from oauth/usage endpoint\ninterface ClaudeUsage {\n  five_hour: { utilization: number; resets_at: string | null } | null;\n  seven_day: { utilization: number; resets_at: string | null } | null;\n  seven_day_sonnet: { utilization: number; resets_at: string | null } | null;\n}\n\n// Codex usage from ChatGPT backend\ninterface CodexUsage {\n  model: string;\n  planType: string;\n  primary: { usedPercent: number; resetAt: number } | null;\n  secondary: { usedPercent: number; resetAt: number } | null;\n}\n\n// Gemini usage from Code Assist API\ninterface GeminiUsage {\n  model: string;\n  usedPercent: number | null;\n  resetAt: string | null;\n}\n\n// Combined usage result\ninterface AllUsage {\n  claude: ClaudeUsage | null;\n  codex: CodexUsage | null;\n  gemini: GeminiUsage | null;\n  fetchedAt: number;\n}\n```","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:31:39.407631055+09:00","created_by":"Z","updated_at":"2026-02-02T01:32:33.226229237+09:00","closed_at":"2026-02-02T01:32:33.226229237+09:00","close_reason":"Closed"}
{"id":"agi-jol","title":"cmd-help-1: /help command with full command list","description":"Implement /help command showing all available commands.\n\n**Requirements:**\n- Create handleHelp() in handlers/commands.ts\n- List all commands: /start, /new, /compact, /status, /context, /help\n- Include brief description for each\n- Use ‚öôÔ∏è emoji for system response\n- Format: Telegram HTML markdown\n\n**Acceptance:**\n- /help displays complete command list\n- Descriptions match actual behavior\n- Clean, readable formatting\n\n**Estimated effort:** 1h","notes":"\n---\nVERIFICATION @ 2026-02-02T08:41:04Z\nStatus: verified\nCommand: cd ~/2lab.ai/claude-telegram-bot.p9 \u0026\u0026 grep -q \"handleHelp\" src/handlers/commands.ts \u0026\u0026 grep -q \"bot.command.*help\" src/index.ts\nExit Code: 0\n\nOutput:\n```\n\n```\n","status":"closed","priority":0,"issue_type":"feature","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T17:25:15.515009949+09:00","created_by":"Z","updated_at":"2026-02-02T17:41:05.830230307+09:00","closed_at":"2026-02-02T17:41:05.830230307+09:00","close_reason":"Implemented /help command with categorized command list, usage tips, and error handling with plain text fallback. Committed 5c88dfc and pushed."}
{"id":"agi-men","title":"Create PR: rust-port","description":"Scope:\n- Review rust-port changes (Rust workspace + docs + deploy scripts)\n- Open GitHub PR from rust-port -\u003e main\nDeliverables:\n- PR link\n- Review notes\n","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T13:11:45.672548321+09:00","created_by":"Z","updated_at":"2026-02-02T14:28:45.497639793+09:00","closed_at":"2026-02-02T14:28:45.497639793+09:00","close_reason":"Closed"}
{"id":"agi-p62","title":"cron job queue system","description":"Implement cron job queue system to prevent jobs from being skipped when session is busy.\n\nCurrently: Cron jobs are skipped if session.isRunning\nGoal: Queue pending cron jobs and execute them when session becomes idle\n\nTasks:\n- [ ] Add pendingCronJobs queue to scheduler.ts (Array\u003c{schedule, timestamp}\u003e)\n- [ ] Modify executeScheduledPrompt: push to queue if session busy\n- [ ] Add processQueuedJobs() function to execute queued jobs\n- [ ] Hook into session completion to call processQueuedJobs()\n- [ ] Add queue status to /cron command output\n- [ ] Test: schedule job while session busy, verify it executes after","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T00:58:04.48459361+09:00","created_by":"Z","updated_at":"2026-02-02T01:09:23.480881355+09:00","closed_at":"2026-02-02T01:09:23.480881355+09:00","close_reason":"Closed"}
{"id":"agi-qzd","title":"Critical: Shell injection in save-and-restart.sh","description":"Security: Shell injection vulnerability in save-and-restart.sh\n\nLocation: save-and-restart.sh:16-25\n\nIssue: MESSAGE variable injected into heredoc without sanitization\nAttack: Message containing EOF or shell metacharacters can break out and execute arbitrary commands\n\nExample attack:\n./save-and-restart.sh 'EOF\n$(rm -rf ~)\ncat \u003c\u003cEOF'\n\nFix: Use quoted heredoc ('EOF') or printf instead of interpolation","status":"closed","priority":0,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:56:05.464760174+09:00","created_by":"Z","updated_at":"2026-02-02T02:10:26.354345237+09:00","closed_at":"2026-02-02T02:10:26.354345237+09:00","close_reason":"Closed"}
{"id":"agi-uey","title":"Fix make up to include service restart","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T00:15:12.002555983+09:00","created_by":"Z","updated_at":"2026-02-02T01:03:23.064613675+09:00","closed_at":"2026-02-02T00:20:06.929627814+09:00","close_reason":"Closed"}
{"id":"agi-utp","title":"cmd-auto-1: Telegram command autocomplete (setMyCommands)","description":"Enable Telegram command autocomplete via bot.api.setMyCommands().\n\n**Requirements:**\n- Call setMyCommands() in src/index.ts after bot creation (line ~40)\n- Static command list: start, new, stop, status, stats, context, help, resume, restart, retry, cron\n- Include short descriptions (max 256 chars each)\n- Set scope: default (all users)\n\n**Current state:**\n- 11 commands registered via bot.command() (lines 109-119)\n- No setMyCommands() call exists yet\n- Grammy bot framework supports bot.api.setMyCommands()\n\n**Implementation:**\nAdd after line ~105 (before command handlers):\n```typescript\nawait bot.api.setMyCommands([\n  { command: 'start', description: 'Welcome message and status' },\n  { command: 'new', description: 'Start fresh session' },\n  // ... rest\n]);\n```\n\n**Estimated effort:** 30min (simpler than 1h)","notes":"\n---\nVERIFICATION @ 2026-02-02T09:10:08Z\nStatus: verified\nCommand: cd ~/2lab.ai/claude-telegram-bot.p9 \u0026\u0026 grep -q \"setMyCommands\" src/index.ts\nExit Code: 0\n\nOutput:\n```\n\n```\n","status":"closed","priority":0,"issue_type":"feature","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T17:25:16.602328138+09:00","created_by":"Z","updated_at":"2026-02-02T18:10:11.318713385+09:00","closed_at":"2026-02-02T18:10:11.318713385+09:00","close_reason":"Implemented bot.api.setMyCommands() for Telegram command autocomplete. Users can now press '/' to see command dropdown menu. Committed 59799c5 and pushed.","dependencies":[{"issue_id":"agi-utp","depends_on_id":"agi-jol","type":"blocks","created_at":"2026-02-02T17:26:07.080275804+09:00","created_by":"Z"}]}
{"id":"agi-vjj","title":"cmd-ctx-1: /context command implementation","description":"Implement /context command that displays real-time token usage.\n\n**Requirements:**\n- Read session.lastUsage.input_tokens + output_tokens\n- Display format: [input+output / 200K] (X%)\n- Update handlers/commands.ts with handleContext()\n- Register bot.command('context', handleContext)\n- Use ‚öôÔ∏è emoji for system message\n\n**Key Finding:**\n- CONTEXT_LIMIT = 200_000 already defined in session.ts:564\n- Current impl accumulates tokens in totalInputTokens/totalOutputTokens\n- Oracle guidance: input_tokens from SDK already includes full history\n- Should use lastUsage directly, not cumulative total\n\n**Acceptance:**\n- /context shows accurate token count using lastUsage\n- Percentage calculation matches 200K window\n- Response uses ‚öôÔ∏è emoji\n\n**Estimated: 45min (simpler than original 60min)**","notes":"\n---\nVERIFICATION @ 2026-02-02T08:40:51Z\nStatus: verified\nCommand: cd ~/2lab.ai/claude-telegram-bot.p9 \u0026\u0026 bun run typecheck \u0026\u0026 grep -q \"handleContext\" src/handlers/commands.ts\nExit Code: 0\n\nOutput:\n```\n$ bun run --bun tsc --noEmit\n```\n","status":"closed","priority":0,"issue_type":"feature","owner":"z@2lab.ai","estimated_minutes":60,"created_at":"2026-02-02T17:25:11.916233027+09:00","created_by":"Z","updated_at":"2026-02-02T17:40:55.093413751+09:00","closed_at":"2026-02-02T17:40:55.093413751+09:00","close_reason":"Implemented /context command with error handling and data validation. Passed typecheck, lint, fmt. Committed 5c88dfc and pushed."}
{"id":"agi-vv1","title":"Real-time steering: inject user messages during Claude execution","description":"Real-time steering Íµ¨ÌòÑ ÏôÑÎ£å (commit 9a50f57).\n\nÍµ¨ÌòÑ ÎÇ¥Ïö©:\n- session.ts: steeringBuffer (addSteering, consumeSteering, hasSteeringMessages)\n- session.ts: PreToolUse hookÏúºÎ°ú systemMessage Ï£ºÏûÖ\n- text.ts: isProcessing Ï≤¥ÌÅ¨ ‚Üí Î≤ÑÌçºÎßÅ (üëå Î∞òÏùë)\n- startProcessing cleanup: ÎØ∏ÏÜåÎπÑ Î≤ÑÌçº ÌÅ¥Î¶¨Ïñ¥\n\nÎÇ®ÏùÄ ÏûëÏóÖ:\n- bd-verifyÎ°ú typecheck Í≤ÄÏ¶ù\n- bd-close-verifiedÎ°ú Ïù¥Ïäà Îã´Í∏∞","notes":"\n---\nVERIFICATION @ 2026-02-02T07:20:11Z\nStatus: verified\nCommand: cd ~/2lab.ai/claude-telegram-bot.p9 \u0026\u0026 bun run typecheck\nExit Code: 0\n\nOutput:\n```\n$ bun run --bun tsc --noEmit\n```\n","status":"closed","priority":0,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:10:15.867941209+09:00","created_by":"Z","updated_at":"2026-02-02T16:20:22.077278885+09:00","closed_at":"2026-02-02T16:20:22.077278885+09:00","close_reason":"Real-time steering Íµ¨ÌòÑ ÏôÑÎ£å (commit 9a50f57). PreToolUse hookÏúºÎ°ú systemMessage Ï£ºÏûÖ, text.tsÏóêÏÑú isProcessing Ï≤¥ÌÅ¨, typecheck ÌÜµÍ≥º Í≤ÄÏ¶ùÎê®."}
{"id":"agi-wdq","title":"message reaction indicators for turn tracking","description":"Add message reactions to indicate conversation turn status.\n\nProblem: User can't tell when Claude has received and is processing their message, or when Claude's turn is complete.\n\nSolution:\n1. When user message received ‚Üí Add reaction (üëÄ or ‚è≥) to user's message\n2. When Claude finishes turn ‚Üí Add reaction (‚úÖ) to Claude's last message\n\nImplementation:\n- Use Telegram setMessageReaction API\n- Add reaction to user message in message handlers\n- Add reaction to bot's last message when turn complete","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T00:59:57.144000709+09:00","created_by":"Z","updated_at":"2026-02-02T01:06:17.441973632+09:00","closed_at":"2026-02-02T01:06:17.441973632+09:00","close_reason":"Closed"}
{"id":"agi-xd7","title":"make up with context message for restart continuity","description":"Feature: Accept context message in make up command\n\nUsage:\nmake up \"current context and next tasks\"\n\nWorkflow:\n1. Before restart: Use oh-my-claude:save skill to save context\n2. Run make up to restart bot\n3. After restart: Auto-load saved context using oh-my-claude:load skill\n\nImplementation:\n- Modify Makefile to accept optional message parameter\n- Save message to docs/tasks/save/ before restart\n- On startup, check for saved context file\n- Notify user to use /load skill or auto-load\n\nGoal: Preserve conversation context across bot restarts","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:27:14.707652686+09:00","created_by":"Z","updated_at":"2026-02-02T01:36:53.259037784+09:00","closed_at":"2026-02-02T01:36:53.259037784+09:00","close_reason":"Closed"}
{"id":"agi-y86","title":"Progress spinner for work status","description":"ÏûëÏóÖ ÏßÑÌñâÏ§ë Î©îÏãúÏßÄ ÌïòÎã®Ïóê Ïä§ÌîºÎÑà ÌëúÏãú:\n1. ÌòÑÏû¨ ÏûëÏóÖ ÏßÑÌñâ ÏÉÅÌÉúÎ•º Îß® ÎßàÏßÄÎßâ Î©îÏãúÏßÄÎ°ú ÌëúÏãú\n2. ÏãúÍ∞Ñ ÌëúÏãú Ï¥àÎßàÎã§ ÏóÖÎç∞Ïù¥Ìä∏\n3. ÏûëÏóÖ ÏôÑÎ£åÏãú: ÏãúÏûëÏãúÍ∞Ñ, Ï¢ÖÎ£åÏãúÍ∞Ñ, ÏÜåÏöîÏãúÍ∞Ñ(Î∂Ñ:Ï¥à) ÌëúÏãú\n4. Íµ¨ÌòÑ ÌõÑ make upÏúºÎ°ú Ïû¨ÏãúÏûëÍπåÏßÄ ÏôÑÎ£å","status":"closed","priority":2,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:04:17.150770594+09:00","created_by":"Z","updated_at":"2026-02-02T01:13:13.891376626+09:00","closed_at":"2026-02-02T01:13:13.891376626+09:00","close_reason":"Closed"}
{"id":"agi-z4i","title":"Bug: done footer can overwrite final reply (stale lastContent)","description":"Regression: In src/handlers/streaming.ts, the done handler appends elapsed time by editing the last bot message with lastContent + timeFooter. But segment_end edits/creates the final segment without updating state.lastContent, so done can overwrite/truncate the final reply by reverting to stale lastContent (or skip footer when lastContent missing).\\n\\nFix: Update state.lastContent whenever segment_end sends/edits/splits, or build footer from the same final formatted value.\\n\\nFiles:\\n- src/handlers/streaming.ts","status":"closed","priority":1,"issue_type":"bug","owner":"z@2lab.ai","created_at":"2026-02-02T16:25:20.586453917+09:00","created_by":"Z","updated_at":"2026-02-02T16:29:06.91292902+09:00","closed_at":"2026-02-02T16:29:06.91292902+09:00","close_reason":"Closed"}
{"id":"agi-zpw","title":"Fix: Progress timer race condition in streaming.ts","description":"Race condition: Timer may edit deleted progress message\n\nLocation: src/handlers/streaming.ts:158-177\n\nIssue: state.progressMessage can be mutated by recreateProgressMessage() while timer's async editMessageText is pending. Timer may hold stale reference.\n\nImpact: Intermittent 'message not found' errors from Telegram API\n\nFix: Capture message reference at start of timer callback and verify hasn't changed","status":"closed","priority":1,"issue_type":"task","owner":"z@2lab.ai","created_at":"2026-02-02T01:47:55.928136054+09:00","created_by":"Z","updated_at":"2026-02-02T01:52:35.232519955+09:00","closed_at":"2026-02-02T01:52:35.232519955+09:00","close_reason":"Closed"}
{"id":"agi-zvr","title":"Progress spinner not showing - race condition in createStatusCallback","description":"ÌòÑÏÉÅ: ÏßÄÌòÅÏù¥ Î¥á ÏÇ¨Ïö© Ï§ë ÏûëÏóÖ ÏãúÍ∞ÑÏù¥ ÌëúÏãúÎêòÏßÄ ÏïäÏùå\n\nÏû¨ÌòÑ:\n- Î¥áÏù¥ ÏûëÏóÖ ÏàòÌñâ Ï§ë\n- ÏßÑÌñâ ÏãúÍ∞Ñ/Í≤ΩÍ≥º ÏãúÍ∞ÑÏù¥ ÎÇòÏôÄÏïº ÌïòÎäîÎç∞ Ïïà ÎÇòÏò¥\n\nÏòàÏÉÅ ÏõêÏù∏:\n- Progress spinner/timer Î°úÏßÅ Î≤ÑÍ∑∏\n- src/handlers/streaming.tsÏùò progress tracking Ïù¥Ïäà\n- ÏµúÍ∑º agi-zpw, agi-5eb ÏàòÏ†ï ÌõÑ regression?\n\nÏ°∞ÏÇ¨ ÌïÑÏöî:\n1. Ïñ¥Îñ§ progress indicatorÍ∞Ä Ïïà ÎÇòÏò§ÎäîÏßÄ ÌôïÏù∏\n2. streaming.tsÏùò timer Î°úÏßÅ Ï≤¥ÌÅ¨\n3. ÏµúÍ∑º Ïª§Î∞ãÍ≥º Ïó∞Í¥ÄÏÑ± ÌôïÏù∏\n\nÎ≥¥Í≥†Ïûê: ÏßÄÌòÅ (2026-02-02 02:27)","notes":"## Root Cause (Systematic Debugging - Phase 1)\n\n**Race Condition in streaming.ts line 162-167:**\n\n```typescript\n// OLD CODE (BROKEN):\nrecreateProgressMessage().catch((error) =\u003e {  // fire-and-forget, NO AWAIT\n  console.debug(\"Failed to create initial progress message:\", error);\n});\n\n// Timer starts IMMEDIATELY, before message is created\nstate.progressTimer = setInterval(async () =\u003e {\n  const currentProgressMsg = state.progressMessage;\n  if (!currentProgressMsg) return;  // ‚Üê Always returns if msg not ready yet\n  ...\n```\n\n**3 Problems:**\n1. **Race condition**: Timer starts before `recreateProgressMessage()` completes\n2. **Silent failure**: If `ctx.reply()` fails, `progressMessage` stays null forever\n3. **No recovery**: Once failed, spinner never appears\n\n## Fix (Phase 4)\n\n**Changed `createStatusCallback()` to async and await message creation:**\n\n```typescript\n// NEW CODE (FIXED):\nexport async function createStatusCallback(...): Promise\u003cStatusCallback\u003e {\n  ...\n  // Wait for initial message to be created BEFORE starting timer\n  await recreateProgressMessage();\n  \n  // Now start timer (message is guaranteed to exist)\n  state.progressTimer = setInterval(...)\n}\n```\n\n**Updated all callers (6 files):**\n- text.ts (2 locations)\n- callback.ts\n- document.ts (2 locations)\n- photo.ts\n- voice.ts\n\n## Verification Needed\n\n**Test:** Send message and verify spinner appears with elapsed time\n**Expected:** `‚†ã Working... (0:01)` message shows and updates every second\n**Pass Criteria:** Spinner visible throughout bot processing\n\nTypecheck: ‚úì Passed\nManual test: ‚è≥ Pending","status":"closed","priority":1,"issue_type":"bug","assignee":"Z","owner":"z@2lab.ai","created_at":"2026-02-02T02:27:52.529150619+09:00","created_by":"Z","updated_at":"2026-02-02T11:39:21.823033816+09:00","closed_at":"2026-02-02T11:39:21.823033816+09:00","close_reason":"Not a bug - Telegram API rate limit issue"}
